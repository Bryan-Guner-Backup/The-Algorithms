<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="reselect">Reselect</h1>
<p><a href="https://travis-ci.org/reduxjs/reselect"><img src="https://img.shields.io/travis/reduxjs/reselect/master.svg?style=flat-square" alt="Travis" /></a> <a href="https://www.npmjs.org/package/reselect"><img src="https://img.shields.io/npm/v/reselect.svg?style=flat-square" alt="npm package" /></a> <a href="https://coveralls.io/github/reduxjs/reselect"><img src="https://img.shields.io/coveralls/reduxjs/reselect/master.svg?style=flat-square" alt="Coveralls" /></a></p>
<p>Simple “selector” library for Redux (and others) inspired by getters in <a href="https://github.com/optimizely/nuclear-js.git">NuclearJS</a>, <a href="https://github.com/Day8/re-frame#just-a-read-only-cursor">subscriptions</a> in <a href="https://github.com/Day8/re-frame">re-frame</a> and this <a href="https://github.com/reduxjs/redux/pull/169">proposal</a> from <a href="https://github.com/speedskater">speedskater</a>.</p>
<ul>
<li>Selectors can compute derived data, allowing Redux to store the minimal possible state.</li>
<li>Selectors are efficient. A selector is not recomputed unless one of its arguments changes.</li>
<li>Selectors are composable. They can be used as input to other selectors.</li>
</ul>
<p>You can play around with the following <strong>example</strong> in <a href="https://codepen.io/Domiii/pen/LzGNWj?editors=0010">this codepen</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">const</span> shopItemsSelector <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">shop</span>.<span class="at">items</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">const</span> taxPercentSelector <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">shop</span>.<span class="at">taxPercent</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">const</span> subtotalSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb1-7" title="7">  shopItemsSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb1-8" title="8">  items <span class="kw">=&gt;</span> <span class="va">items</span>.<span class="at">reduce</span>((acc<span class="op">,</span> item) <span class="kw">=&gt;</span> acc <span class="op">+</span> <span class="va">item</span>.<span class="at">value</span><span class="op">,</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">const</span> taxSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb1-12" title="12">  subtotalSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb1-13" title="13">  taxPercentSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb1-14" title="14">  (subtotal<span class="op">,</span> taxPercent) <span class="kw">=&gt;</span> subtotal <span class="op">*</span> (taxPercent / <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb1-15" title="15">)</a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="im">export</span> <span class="kw">const</span> totalSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb1-18" title="18">  subtotalSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb1-19" title="19">  taxSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb1-20" title="20">  (subtotal<span class="op">,</span> tax) <span class="kw">=&gt;</span> (<span class="op">{</span> <span class="dt">total</span><span class="op">:</span> subtotal <span class="op">+</span> tax <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-21" title="21">)</a>
<a class="sourceLine" id="cb1-22" title="22"></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="kw">let</span> exampleState <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-24" title="24">  <span class="dt">shop</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-25" title="25">    <span class="dt">taxPercent</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-26" title="26">    <span class="dt">items</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb1-27" title="27">      <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;apple&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.20</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb1-28" title="28">      <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;orange&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.95</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb1-29" title="29">    ]</a>
<a class="sourceLine" id="cb1-30" title="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb1-31" title="31"><span class="op">}</span></a>
<a class="sourceLine" id="cb1-32" title="32"></a>
<a class="sourceLine" id="cb1-33" title="33"><span class="va">console</span>.<span class="at">log</span>(<span class="at">subtotalSelector</span>(exampleState)) <span class="co">// 2.15</span></a>
<a class="sourceLine" id="cb1-34" title="34"><span class="va">console</span>.<span class="at">log</span>(<span class="at">taxSelector</span>(exampleState))      <span class="co">// 0.172</span></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="va">console</span>.<span class="at">log</span>(<span class="at">totalSelector</span>(exampleState))    <span class="co">// { total: 2.322 }</span></a></code></pre></div>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#example">Example</a>
<ul>
<li><a href="#motivation-for-memoized-selectors">Motivation for Memoized Selectors</a></li>
<li><a href="#creating-a-memoized-selector">Creating a Memoized Selector</a></li>
<li><a href="#composing-selectors">Composing Selectors</a></li>
<li><a href="#connecting-a-selector-to-the-redux-store">Connecting a Selector to the Redux Store</a></li>
<li><a href="#accessing-react-props-in-selectors">Accessing React Props in Selectors</a></li>
<li><a href="#sharing-selectors-with-props-across-multiple-component-instances">Sharing Selectors with Props Across Multiple Component Instances</a></li>
</ul></li>
<li><a href="#api">API</a>
<ul>
<li><a href="#createselectorinputselectors--inputselectors-resultfunc"><code>createSelector</code></a></li>
<li><a href="#defaultmemoizefunc-equalitycheck--defaultequalitycheck"><code>defaultMemoize</code></a></li>
<li><a href="#createselectorcreatormemoize-memoizeoptions"><code>createSelectorCreator</code></a></li>
<li><a href="#createstructuredselectorinputselectors-selectorcreator--createselector"><code>createStructuredSelector</code></a></li>
</ul></li>
<li><a href="#faq">FAQ</a>
<ul>
<li><a href="#q-why-isnt-my-selector-recomputing-when-the-input-state-changes">Why isn’t my selector recomputing when the input state changes?</a></li>
<li><a href="#q-why-is-my-selector-recomputing-when-the-input-state-stays-the-same">Why is my selector recomputing when the input state stays the same?</a></li>
<li><a href="#q-can-i-use-reselect-without-redux">Can I use Reselect without Redux?</a></li>
<li><a href="#q-the-default-memoization-function-is-no-good-can-i-use-a-different-one">The default memoization function is no good, can I use a different one?</a></li>
<li><a href="#q-how-do-i-test-a-selector">How do I test a selector?</a></li>
<li><a href="#q-how-do-i-create-a-selector-that-takes-an-argument">How do I create a selector that takes an argument?</a></li>
<li><a href="#q-how-do-i-use-reselect-with-immutablejs">How do I use Reselect with Immutable.js?</a></li>
<li><a href="#q-can-i-share-a-selector-across-multiple-component-instances">Can I share a selector across multiple component instances?</a></li>
<li><a href="#q-are-there-typescript-typings">Are there TypeScript typings?</a></li>
<li><a href="#q-how-can-i-make-a-curried-selector">How can I make a curried selector?</a></li>
</ul></li>
<li><a href="#related-projects">Related Projects</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="installation">Installation</h2>
<pre><code>npm install reselect</code></pre>
<h2 id="example">Example</h2>
<p>If you prefer a video tutorial, you can find one <a href="https://www.youtube.com/watch?v=6Xwo5mVxDqI">here</a>.</p>
<h3 id="motivation-for-memoized-selectors">Motivation for Memoized Selectors</h3>
<blockquote>
<p>The examples in this section are based on the <a href="http://redux.js.org/docs/basics/UsageWithReact.html">Redux Todos List example</a>.</p>
</blockquote>
<h4 id="containersvisibletodolist.js"><code>containers/VisibleTodoList.js</code></h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">import</span> <span class="op">{</span> toggleTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions&#39;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="im">import</span> TodoList <span class="im">from</span> <span class="st">&#39;../components/TodoList&#39;</span></a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">const</span> getVisibleTodos <span class="op">=</span> (todos<span class="op">,</span> filter) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="cf">switch</span> (filter) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="cf">case</span> <span class="st">&#39;SHOW_ALL&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-8" title="8">      <span class="cf">return</span> todos</a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="cf">case</span> <span class="st">&#39;SHOW_COMPLETED&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-10" title="10">      <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(t <span class="kw">=&gt;</span> <span class="va">t</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="cf">case</span> <span class="st">&#39;SHOW_ACTIVE&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-12" title="12">      <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(t <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">t</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="dt">todos</span><span class="op">:</span> <span class="at">getVisibleTodos</span>(<span class="va">state</span>.<span class="at">todos</span><span class="op">,</span> <span class="va">state</span>.<span class="at">visibilityFilter</span>)</a>
<a class="sourceLine" id="cb3-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-23" title="23">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-24" title="24">    <span class="dt">onTodoClick</span><span class="op">:</span> (id) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-25" title="25">      <span class="at">dispatch</span>(<span class="at">toggleTodo</span>(id))</a>
<a class="sourceLine" id="cb3-26" title="26">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="kw">const</span> VisibleTodoList <span class="op">=</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb3-31" title="31">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb3-32" title="32">  mapDispatchToProps</a>
<a class="sourceLine" id="cb3-33" title="33">)(TodoList)</a>
<a class="sourceLine" id="cb3-34" title="34"></a>
<a class="sourceLine" id="cb3-35" title="35"><span class="im">export</span> <span class="im">default</span> VisibleTodoList</a></code></pre></div>
<p>In the above example, <code>mapStateToProps</code> calls <code>getVisibleTodos</code> to calculate <code>todos</code>. This works great, but there is a drawback: <code>todos</code> is calculated every time the state tree is updated. If the state tree is large, or the calculation expensive, repeating the calculation on every update may cause performance problems. Reselect can help to avoid these unnecessary recalculations.</p>
<h3 id="creating-a-memoized-selector">Creating a Memoized Selector</h3>
<p>We would like to replace <code>getVisibleTodos</code> with a memoized selector that recalculates <code>todos</code> when the value of <code>state.todos</code> or <code>state.visibilityFilter</code> changes, but not when changes occur in other (unrelated) parts of the state tree.</p>
<p>Reselect provides a function <code>createSelector</code> for creating memoized selectors. <code>createSelector</code> takes an array of input-selectors and a transform function as its arguments. If the Redux state tree is mutated in a way that causes the value of an input-selector to change, the selector will call its transform function with the values of the input-selectors as arguments and return the result. If the values of the input-selectors are the same as the previous call to the selector, it will return the previously computed value instead of calling the transform function.</p>
<p>Let’s define a memoized selector named <code>getVisibleTodos</code> to replace the non-memoized version above:</p>
<h4 id="selectorsindex.js"><code>selectors/index.js</code></h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">const</span> getVisibilityFilter <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">visibilityFilter</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">const</span> getTodos <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">todos</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="im">export</span> <span class="kw">const</span> getVisibleTodos <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb4-7" title="7">  [ getVisibilityFilter<span class="op">,</span> getTodos ]<span class="op">,</span></a>
<a class="sourceLine" id="cb4-8" title="8">  (visibilityFilter<span class="op">,</span> todos) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="cf">switch</span> (visibilityFilter) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-10" title="10">      <span class="cf">case</span> <span class="st">&#39;SHOW_ALL&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb4-11" title="11">        <span class="cf">return</span> todos</a>
<a class="sourceLine" id="cb4-12" title="12">      <span class="cf">case</span> <span class="st">&#39;SHOW_COMPLETED&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(t <span class="kw">=&gt;</span> <span class="va">t</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb4-14" title="14">      <span class="cf">case</span> <span class="st">&#39;SHOW_ACTIVE&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb4-15" title="15">        <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(t <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">t</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb4-18" title="18">)</a></code></pre></div>
<p>In the example above, <code>getVisibilityFilter</code> and <code>getTodos</code> are input-selectors. They are created as ordinary non-memoized selector functions because they do not transform the data they select. <code>getVisibleTodos</code> on the other hand is a memoized selector. It takes <code>getVisibilityFilter</code> and <code>getTodos</code> as input-selectors, and a transform function that calculates the filtered todos list.</p>
<h3 id="composing-selectors">Composing Selectors</h3>
<p>A memoized selector can itself be an input-selector to another memoized selector. Here is <code>getVisibleTodos</code> being used as an input-selector to a selector that further filters the todos by keyword:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> getKeyword <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">keyword</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">const</span> getVisibleTodosFilteredByKeyword <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb5-4" title="4">  [ getVisibleTodos<span class="op">,</span> getKeyword ]<span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">  (visibleTodos<span class="op">,</span> keyword) <span class="kw">=&gt;</span> <span class="va">visibleTodos</span>.<span class="at">filter</span>(</a>
<a class="sourceLine" id="cb5-6" title="6">    todo <span class="kw">=&gt;</span> <span class="va">todo</span>.<span class="va">text</span>.<span class="at">includes</span>(keyword)</a>
<a class="sourceLine" id="cb5-7" title="7">  )</a>
<a class="sourceLine" id="cb5-8" title="8">)</a></code></pre></div>
<h3 id="connecting-a-selector-to-the-redux-store">Connecting a Selector to the Redux Store</h3>
<p>If you are using <a href="https://github.com/reduxjs/react-redux">React Redux</a>, you can call selectors as regular functions inside <code>mapStateToProps()</code>:</p>
<h4 id="containersvisibletodolist.js-1"><code>containers/VisibleTodoList.js</code></h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="im">import</span> <span class="op">{</span> toggleTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions&#39;</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="im">import</span> TodoList <span class="im">from</span> <span class="st">&#39;../components/TodoList&#39;</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="im">import</span> <span class="op">{</span> getVisibleTodos <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../selectors&#39;</span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="dt">todos</span><span class="op">:</span> <span class="at">getVisibleTodos</span>(state)</a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="op">}</span></a>
<a class="sourceLine" id="cb6-11" title="11"></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-13" title="13">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-14" title="14">    <span class="dt">onTodoClick</span><span class="op">:</span> (id) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-15" title="15">      <span class="at">dispatch</span>(<span class="at">toggleTodo</span>(id))</a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="kw">const</span> VisibleTodoList <span class="op">=</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb6-21" title="21">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb6-22" title="22">  mapDispatchToProps</a>
<a class="sourceLine" id="cb6-23" title="23">)(TodoList)</a>
<a class="sourceLine" id="cb6-24" title="24"></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="im">export</span> <span class="im">default</span> VisibleTodoList</a></code></pre></div>
<h3 id="accessing-react-props-in-selectors">Accessing React Props in Selectors</h3>
<blockquote>
<p>This section introduces a hypothetical extension to our app that allows it to support multiple Todo Lists. Please note that a full implementation of this extension requires changes to the reducers, components, actions etc. that aren’t directly relevant to the topics discussed and have been omitted for brevity.</p>
</blockquote>
<p>So far we have only seen selectors receive the Redux store state as an argument, but a selector can receive props too.</p>
<p>Here is an <code>App</code> component that renders three <code>VisibleTodoList</code> component instances, each of which has a <code>listId</code> prop:</p>
<h4 id="componentsapp.js"><code>components/App.js</code></h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="im">import</span> Footer <span class="im">from</span> <span class="st">&#39;./Footer&#39;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="im">import</span> AddTodo <span class="im">from</span> <span class="st">&#39;../containers/AddTodo&#39;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="im">import</span> VisibleTodoList <span class="im">from</span> <span class="st">&#39;../containers/VisibleTodoList&#39;</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="op">&lt;</span>VisibleTodoList listId<span class="op">=</span><span class="st">&quot;1&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="op">&lt;</span>VisibleTodoList listId<span class="op">=</span><span class="st">&quot;2&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="op">&lt;</span>VisibleTodoList listId<span class="op">=</span><span class="st">&quot;3&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb7-11" title="11">  &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb7-12" title="12">)</a></code></pre></div>
<p>Each <code>VisibleTodoList</code> container should select a different slice of the state depending on the value of the <code>listId</code> prop, so let’s modify <code>getVisibilityFilter</code> and <code>getTodos</code> to accept a props argument:</p>
<h4 id="selectorstodoselectors.js"><code>selectors/todoSelectors.js</code></h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">const</span> getVisibilityFilter <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="va">state</span>.<span class="at">todoLists</span>[<span class="va">props</span>.<span class="at">listId</span>].<span class="at">visibilityFilter</span></a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">const</span> getTodos <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="va">state</span>.<span class="at">todoLists</span>[<span class="va">props</span>.<span class="at">listId</span>].<span class="at">todos</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">const</span> getVisibleTodos <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb8-10" title="10">  [ getVisibilityFilter<span class="op">,</span> getTodos ]<span class="op">,</span></a>
<a class="sourceLine" id="cb8-11" title="11">  (visibilityFilter<span class="op">,</span> todos) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="cf">switch</span> (visibilityFilter) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-13" title="13">      <span class="cf">case</span> <span class="st">&#39;SHOW_COMPLETED&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb8-14" title="14">        <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(todo <span class="kw">=&gt;</span> <span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb8-15" title="15">      <span class="cf">case</span> <span class="st">&#39;SHOW_ACTIVE&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb8-16" title="16">        <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(todo <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb8-17" title="17">      <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb8-18" title="18">        <span class="cf">return</span> todos</a>
<a class="sourceLine" id="cb8-19" title="19">    <span class="op">}</span></a>
<a class="sourceLine" id="cb8-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb8-21" title="21">)</a>
<a class="sourceLine" id="cb8-22" title="22"></a>
<a class="sourceLine" id="cb8-23" title="23"><span class="im">export</span> <span class="im">default</span> getVisibleTodos</a></code></pre></div>
<p><code>props</code> can be passed to <code>getVisibleTodos</code> from <code>mapStateToProps</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="dt">todos</span><span class="op">:</span> <span class="at">getVisibleTodos</span>(state<span class="op">,</span> props)</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>So now <code>getVisibleTodos</code> has access to <code>props</code>, and everything seems to be working fine.</p>
<p><strong>But there is a problem!</strong></p>
<p>Using the <code>getVisibleTodos</code> selector with multiple instances of the <code>VisibleTodoList</code> container will not correctly memoize:</p>
<h4 id="containersvisibletodolist.js-2"><code>containers/VisibleTodoList.js</code></h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="im">import</span> <span class="op">{</span> toggleTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions&#39;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="im">import</span> TodoList <span class="im">from</span> <span class="st">&#39;../components/TodoList&#39;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="im">import</span> <span class="op">{</span> getVisibleTodos <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../selectors&#39;</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="co">// </span><span class="al">WARNING</span><span class="co">: THE FOLLOWING SELECTOR DOES NOT CORRECTLY MEMOIZE</span></a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="dt">todos</span><span class="op">:</span> <span class="at">getVisibleTodos</span>(state<span class="op">,</span> props)</a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-12" title="12"></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-14" title="14">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-15" title="15">    <span class="dt">onTodoClick</span><span class="op">:</span> (id) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-16" title="16">      <span class="at">dispatch</span>(<span class="at">toggleTodo</span>(id))</a>
<a class="sourceLine" id="cb10-17" title="17">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-20" title="20"></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">const</span> VisibleTodoList <span class="op">=</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb10-22" title="22">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb10-23" title="23">  mapDispatchToProps</a>
<a class="sourceLine" id="cb10-24" title="24">)(TodoList)</a>
<a class="sourceLine" id="cb10-25" title="25"></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="im">export</span> <span class="im">default</span> VisibleTodoList</a></code></pre></div>
<p>A selector created with <code>createSelector</code> has a cache size of 1 and only returns the cached value when its set of arguments is the same as its previous set of arguments. If we alternate between rendering <code>&lt;VisibleTodoList listId="1" /&gt;</code> and <code>&lt;VisibleTodoList listId="2" /&gt;</code>, the shared selector will alternate between receiving <code>{listId: 1}</code> and <code>{listId: 2}</code> as its <code>props</code> argument. This will cause the arguments to be different on each call, so the selector will always recompute instead of returning the cached value. We’ll see how to overcome this limitation in the next section.</p>
<h3 id="sharing-selectors-with-props-across-multiple-component-instances">Sharing Selectors with Props Across Multiple Component Instances</h3>
<blockquote>
<p>The examples in this section require React Redux v4.3.0 or greater</p>
</blockquote>
<blockquote>
<p>An alternative approach can be found in <a href="https://github.com/toomuchdesign/re-reselect">re-reselect</a></p>
</blockquote>
<p>To share a selector across multiple <code>VisibleTodoList</code> instances while passing in <code>props</code> <strong>and</strong> retaining memoization, each instance of the component needs its own private copy of the selector.</p>
<p>Let’s create a function named <code>makeGetVisibleTodos</code> that returns a new copy of the <code>getVisibleTodos</code> selector each time it is called:</p>
<h4 id="selectorstodoselectors.js-1"><code>selectors/todoSelectors.js</code></h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">const</span> getVisibilityFilter <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="va">state</span>.<span class="at">todoLists</span>[<span class="va">props</span>.<span class="at">listId</span>].<span class="at">visibilityFilter</span></a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="kw">const</span> getTodos <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="va">state</span>.<span class="at">todoLists</span>[<span class="va">props</span>.<span class="at">listId</span>].<span class="at">todos</span></a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="kw">const</span> makeGetVisibleTodos <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="cf">return</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb11-11" title="11">    [ getVisibilityFilter<span class="op">,</span> getTodos ]<span class="op">,</span></a>
<a class="sourceLine" id="cb11-12" title="12">    (visibilityFilter<span class="op">,</span> todos) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-13" title="13">      <span class="cf">switch</span> (visibilityFilter) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-14" title="14">        <span class="cf">case</span> <span class="st">&#39;SHOW_COMPLETED&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-15" title="15">          <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(todo <span class="kw">=&gt;</span> <span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb11-16" title="16">        <span class="cf">case</span> <span class="st">&#39;SHOW_ACTIVE&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-17" title="17">          <span class="cf">return</span> <span class="va">todos</span>.<span class="at">filter</span>(todo <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb11-18" title="18">        <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-19" title="19">          <span class="cf">return</span> todos</a>
<a class="sourceLine" id="cb11-20" title="20">      <span class="op">}</span></a>
<a class="sourceLine" id="cb11-21" title="21">    <span class="op">}</span></a>
<a class="sourceLine" id="cb11-22" title="22">  )</a>
<a class="sourceLine" id="cb11-23" title="23"><span class="op">}</span></a>
<a class="sourceLine" id="cb11-24" title="24"></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="im">export</span> <span class="im">default</span> makeGetVisibleTodos</a></code></pre></div>
<p>We also need a way to give each instance of a container access to its own private selector. The <code>mapStateToProps</code> argument of <code>connect</code> can help with this.</p>
<p><strong>If the <code>mapStateToProps</code> argument supplied to <code>connect</code> returns a function instead of an object, it will be used to create an individual <code>mapStateToProps</code> function for each instance of the container.</strong></p>
<p>In the example below <code>makeMapStateToProps</code> creates a new <code>getVisibleTodos</code> selector, and returns a <code>mapStateToProps</code> function that has exclusive access to the new selector:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">const</span> makeMapStateToProps <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw">const</span> getVisibleTodos <span class="op">=</span> <span class="at">makeGetVisibleTodos</span>()</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-5" title="5">      <span class="dt">todos</span><span class="op">:</span> <span class="at">getVisibleTodos</span>(state<span class="op">,</span> props)</a>
<a class="sourceLine" id="cb12-6" title="6">    <span class="op">}</span></a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="cf">return</span> mapStateToProps</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>If we pass <code>makeMapStateToProps</code> to <code>connect</code>, each instance of the <code>VisibleTodoList</code> container will get its own <code>mapStateToProps</code> function with a private <code>getVisibleTodos</code> selector. Memoization will now work correctly regardless of the render order of the <code>VisibleTodoList</code> containers.</p>
<h4 id="containersvisibletodolist.js-3"><code>containers/VisibleTodoList.js</code></h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="im">import</span> <span class="op">{</span> toggleTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions&#39;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="im">import</span> TodoList <span class="im">from</span> <span class="st">&#39;../components/TodoList&#39;</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="im">import</span> <span class="op">{</span> makeGetVisibleTodos <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../selectors&#39;</span></a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw">const</span> makeMapStateToProps <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="kw">const</span> getVisibleTodos <span class="op">=</span> <span class="at">makeGetVisibleTodos</span>()</a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-10" title="10">      <span class="dt">todos</span><span class="op">:</span> <span class="at">getVisibleTodos</span>(state<span class="op">,</span> props)</a>
<a class="sourceLine" id="cb13-11" title="11">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="cf">return</span> mapStateToProps</a>
<a class="sourceLine" id="cb13-14" title="14"><span class="op">}</span></a>
<a class="sourceLine" id="cb13-15" title="15"></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-17" title="17">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-18" title="18">    <span class="dt">onTodoClick</span><span class="op">:</span> (id) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-19" title="19">      <span class="at">dispatch</span>(<span class="at">toggleTodo</span>(id))</a>
<a class="sourceLine" id="cb13-20" title="20">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-21" title="21">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="op">}</span></a>
<a class="sourceLine" id="cb13-23" title="23"></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="kw">const</span> VisibleTodoList <span class="op">=</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb13-25" title="25">  makeMapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb13-26" title="26">  mapDispatchToProps</a>
<a class="sourceLine" id="cb13-27" title="27">)(TodoList)</a>
<a class="sourceLine" id="cb13-28" title="28"></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="im">export</span> <span class="im">default</span> VisibleTodoList</a></code></pre></div>
<h2 id="api">API</h2>
<h3 id="createselectorinputselectors-inputselectors-resultfunc">createSelector(…inputSelectors | [inputSelectors], resultFunc)</h3>
<p>Takes one or more selectors, or an array of selectors, computes their values and passes them as arguments to <code>resultFunc</code>.</p>
<p><code>createSelector</code> determines if the value returned by an input-selector has changed between calls using reference equality (<code>===</code>). Inputs to selectors created with <code>createSelector</code> should be immutable.</p>
<p>Selectors created with <code>createSelector</code> have a cache size of 1. This means they always recalculate when the value of an input-selector changes, as a selector only stores the preceding value of each input-selector.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">const</span> mySelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb14-2" title="2">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">values</span>.<span class="at">value1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-3" title="3">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">values</span>.<span class="at">value2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-4" title="4">  (value1<span class="op">,</span> value2) <span class="kw">=&gt;</span> value1 <span class="op">+</span> value2</a>
<a class="sourceLine" id="cb14-5" title="5">)</a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co">// You can also pass an array of selectors</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="kw">const</span> totalSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb14-9" title="9">  [</a>
<a class="sourceLine" id="cb14-10" title="10">    state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">values</span>.<span class="at">value1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-11" title="11">    state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">values</span>.<span class="at">value2</span></a>
<a class="sourceLine" id="cb14-12" title="12">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb14-13" title="13">  (value1<span class="op">,</span> value2) <span class="kw">=&gt;</span> value1 <span class="op">+</span> value2</a>
<a class="sourceLine" id="cb14-14" title="14">)</a></code></pre></div>
<p>It can be useful to access the props of a component from within a selector. When a selector is connected to a component with <code>connect</code>, the component props are passed as the second argument to the selector:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">const</span> abSelector <span class="op">=</span> (state<span class="op">,</span> props) <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">a</span> <span class="op">*</span> <span class="va">props</span>.<span class="at">b</span></a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">// props only (ignoring state argument)</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">const</span> cSelector <span class="op">=</span>  (_<span class="op">,</span> props) <span class="kw">=&gt;</span> <span class="va">props</span>.<span class="at">c</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">// state only (props argument omitted as not required)</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="kw">const</span> dSelector <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">d</span></a>
<a class="sourceLine" id="cb15-8" title="8"></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="kw">const</span> totalSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb15-10" title="10">  abSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb15-11" title="11">  cSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb15-12" title="12">  dSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb15-13" title="13">  (ab<span class="op">,</span> c<span class="op">,</span> d) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb15-14" title="14">    <span class="dt">total</span><span class="op">:</span> ab <span class="op">+</span> c <span class="op">+</span> d</a>
<a class="sourceLine" id="cb15-15" title="15">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb15-16" title="16">)</a></code></pre></div>
<h3 id="defaultmemoizefunc-equalitycheck-defaultequalitycheck">defaultMemoize(func, equalityCheck = defaultEqualityCheck)</h3>
<p><code>defaultMemoize</code> memoizes the function passed in the func parameter. It is the memoize function used by <code>createSelector</code>.</p>
<p><code>defaultMemoize</code> has a cache size of 1. This means it always recalculates when the value of an argument changes.</p>
<p><code>defaultMemoize</code> determines if an argument has changed by calling the <code>equalityCheck</code> function. As <code>defaultMemoize</code> is designed to be used with immutable data, the default <code>equalityCheck</code> function checks for changes using reference equality:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">function</span> <span class="at">defaultEqualityCheck</span>(currentVal<span class="op">,</span> previousVal) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="cf">return</span> currentVal <span class="op">===</span> previousVal</a>
<a class="sourceLine" id="cb16-3" title="3"><span class="op">}</span></a></code></pre></div>
<p><code>defaultMemoize</code> can be used with <code>createSelectorCreator</code> to <a href="#customize-equalitycheck-for-defaultmemoize">customize the <code>equalityCheck</code> function</a>.</p>
<h3 id="createselectorcreatormemoize-memoizeoptions">createSelectorCreator(memoize, …memoizeOptions)</h3>
<p><code>createSelectorCreator</code> can be used to make a customized version of <code>createSelector</code>.</p>
<p>The <code>memoize</code> argument is a memoization function to replace <code>defaultMemoize</code>.</p>
<p>The <code>...memoizeOptions</code> rest parameters are zero or more configuration options to be passed to <code>memoizeFunc</code>. The selectors <code>resultFunc</code> is passed as the first argument to <code>memoize</code> and the <code>memoizeOptions</code> are passed as the second argument onwards:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">const</span> customSelectorCreator <span class="op">=</span> <span class="at">createSelectorCreator</span>(</a>
<a class="sourceLine" id="cb17-2" title="2">  customMemoize<span class="op">,</span> <span class="co">// function to be used to memoize resultFunc</span></a>
<a class="sourceLine" id="cb17-3" title="3">  option1<span class="op">,</span> <span class="co">// option1 will be passed as second argument to customMemoize</span></a>
<a class="sourceLine" id="cb17-4" title="4">  option2<span class="op">,</span> <span class="co">// option2 will be passed as third argument to customMemoize</span></a>
<a class="sourceLine" id="cb17-5" title="5">  option3 <span class="co">// option3 will be passed as fourth argument to customMemoize</span></a>
<a class="sourceLine" id="cb17-6" title="6">)</a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="kw">const</span> customSelector <span class="op">=</span> <span class="at">customSelectorCreator</span>(</a>
<a class="sourceLine" id="cb17-9" title="9">  input1<span class="op">,</span></a>
<a class="sourceLine" id="cb17-10" title="10">  input2<span class="op">,</span></a>
<a class="sourceLine" id="cb17-11" title="11">  resultFunc <span class="co">// resultFunc will be passed as first argument to customMemoize</span></a>
<a class="sourceLine" id="cb17-12" title="12">)</a></code></pre></div>
<p>Internally <code>customSelector</code> calls the memoize function as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="at">customMemoize</span>(resultFunc<span class="op">,</span> option1<span class="op">,</span> option2<span class="op">,</span> option3)</a></code></pre></div>
<p>Here are some examples of how you might use <code>createSelectorCreator</code>:</p>
<h4 id="customize-equalitycheck-for-defaultmemoize">Customize <code>equalityCheck</code> for <code>defaultMemoize</code></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelectorCreator<span class="op">,</span> defaultMemoize <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="im">import</span> isEqual <span class="im">from</span> <span class="st">&#39;lodash.isEqual&#39;</span></a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">// create a &quot;selector creator&quot; that uses lodash.isEqual instead of ===</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="kw">const</span> createDeepEqualSelector <span class="op">=</span> <span class="at">createSelectorCreator</span>(</a>
<a class="sourceLine" id="cb19-6" title="6">  defaultMemoize<span class="op">,</span></a>
<a class="sourceLine" id="cb19-7" title="7">  isEqual</a>
<a class="sourceLine" id="cb19-8" title="8">)</a>
<a class="sourceLine" id="cb19-9" title="9"></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co">// use the new &quot;selector creator&quot; to create a selector</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="kw">const</span> mySelector <span class="op">=</span> <span class="at">createDeepEqualSelector</span>(</a>
<a class="sourceLine" id="cb19-12" title="12">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="va">values</span>.<span class="at">filter</span>(val <span class="kw">=&gt;</span> val <span class="op">&lt;</span> <span class="dv">5</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb19-13" title="13">  values <span class="kw">=&gt;</span> <span class="va">values</span>.<span class="at">reduce</span>((acc<span class="op">,</span> val) <span class="kw">=&gt;</span> acc <span class="op">+</span> val<span class="op">,</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb19-14" title="14">)</a></code></pre></div>
<h4 id="use-memoize-function-from-lodash-for-an-unbounded-cache">Use memoize function from lodash for an unbounded cache</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelectorCreator <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="im">import</span> memoize <span class="im">from</span> <span class="st">&#39;lodash.memoize&#39;</span></a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="kw">let</span> called <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="kw">const</span> hashFn <span class="op">=</span> (...<span class="at">args</span>) <span class="kw">=&gt;</span> <span class="va">args</span>.<span class="at">reduce</span>(</a>
<a class="sourceLine" id="cb20-6" title="6">  (acc<span class="op">,</span> val) <span class="kw">=&gt;</span> acc <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> <span class="va">JSON</span>.<span class="at">stringify</span>(val)<span class="op">,</span></a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb20-8" title="8">)</a>
<a class="sourceLine" id="cb20-9" title="9"><span class="kw">const</span> customSelectorCreator <span class="op">=</span> <span class="at">createSelectorCreator</span>(memoize<span class="op">,</span> hashFn)</a>
<a class="sourceLine" id="cb20-10" title="10"><span class="kw">const</span> selector <span class="op">=</span> <span class="at">customSelectorCreator</span>(</a>
<a class="sourceLine" id="cb20-11" title="11">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">a</span><span class="op">,</span></a>
<a class="sourceLine" id="cb20-12" title="12">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">b</span><span class="op">,</span></a>
<a class="sourceLine" id="cb20-13" title="13">  (a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb20-14" title="14">    called<span class="op">++</span></a>
<a class="sourceLine" id="cb20-15" title="15">    <span class="cf">return</span> a <span class="op">+</span> b</a>
<a class="sourceLine" id="cb20-16" title="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb20-17" title="17">)</a></code></pre></div>
<h3 id="createstructuredselectorinputselectors-selectorcreator-createselector">createStructuredSelector({inputSelectors}, selectorCreator = createSelector)</h3>
<p><code>createStructuredSelector</code> is a convenience function for a common pattern that arises when using Reselect. The selector passed to a <code>connect</code> decorator often just takes the values of its input-selectors and maps them to keys in an object:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">const</span> mySelectorA <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">a</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">const</span> mySelectorB <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">b</span></a>
<a class="sourceLine" id="cb21-3" title="3"></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="co">// The result function in the following selector</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="co">// is simply building an object from the input selectors</span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="kw">const</span> structuredSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb21-7" title="7">   mySelectorA<span class="op">,</span></a>
<a class="sourceLine" id="cb21-8" title="8">   mySelectorB<span class="op">,</span></a>
<a class="sourceLine" id="cb21-9" title="9">   mySelectorC<span class="op">,</span></a>
<a class="sourceLine" id="cb21-10" title="10">   (a<span class="op">,</span> b<span class="op">,</span> c) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb21-11" title="11">     a<span class="op">,</span></a>
<a class="sourceLine" id="cb21-12" title="12">     b<span class="op">,</span></a>
<a class="sourceLine" id="cb21-13" title="13">     c</a>
<a class="sourceLine" id="cb21-14" title="14">   <span class="op">}</span>)</a>
<a class="sourceLine" id="cb21-15" title="15">)</a></code></pre></div>
<p><code>createStructuredSelector</code> takes an object whose properties are input-selectors and returns a structured selector. The structured selector returns an object with the same keys as the <code>inputSelectors</code> argument, but with the selectors replaced with their values.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">const</span> mySelectorA <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">a</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">const</span> mySelectorB <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">b</span></a>
<a class="sourceLine" id="cb22-3" title="3"></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="kw">const</span> structuredSelector <span class="op">=</span> <span class="at">createStructuredSelector</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb22-5" title="5">  <span class="dt">x</span><span class="op">:</span> mySelectorA<span class="op">,</span></a>
<a class="sourceLine" id="cb22-6" title="6">  <span class="dt">y</span><span class="op">:</span> mySelectorB</a>
<a class="sourceLine" id="cb22-7" title="7"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb22-8" title="8"></a>
<a class="sourceLine" id="cb22-9" title="9"><span class="kw">const</span> result <span class="op">=</span> <span class="at">structuredSelector</span>(<span class="op">{</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span>) <span class="co">// will produce { x: 1, y: 2 }</span></a></code></pre></div>
<p>Structured selectors can be nested:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">const</span> nestedSelector <span class="op">=</span> <span class="at">createStructuredSelector</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="dt">subA</span><span class="op">:</span> <span class="at">createStructuredSelector</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb23-3" title="3">    selectorA<span class="op">,</span></a>
<a class="sourceLine" id="cb23-4" title="4">    selectorB</a>
<a class="sourceLine" id="cb23-5" title="5">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb23-6" title="6">  <span class="dt">subB</span><span class="op">:</span> <span class="at">createStructuredSelector</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb23-7" title="7">    selectorC<span class="op">,</span></a>
<a class="sourceLine" id="cb23-8" title="8">    selectorD</a>
<a class="sourceLine" id="cb23-9" title="9">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb23-10" title="10"><span class="op">}</span>)</a></code></pre></div>
<h2 id="faq">FAQ</h2>
<h3 id="q-why-isnt-my-selector-recomputing-when-the-input-state-changes">Q: Why isn’t my selector recomputing when the input state changes?</h3>
<p>A: Check that your memoization function is compatible with your state update function (i.e. the reducer if you are using Redux). For example, a selector created with <code>createSelector</code> will not work with a state update function that mutates an existing object instead of creating a new one each time. <code>createSelector</code> uses an identity check (<code>===</code>) to detect that an input has changed, so mutating an existing object will not trigger the selector to recompute because mutating an object does not change its identity. Note that if you are using Redux, mutating the state object is <a href="http://redux.js.org/docs/Troubleshooting.html">almost certainly a mistake</a>.</p>
<p>The following example defines a simple selector that determines if the first todo item in an array of todos has been completed:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">const</span> isFirstTodoCompleteSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb24-2" title="2">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">todos</span>[<span class="dv">0</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb24-3" title="3">  todo <span class="kw">=&gt;</span> todo <span class="op">&amp;&amp;</span> <span class="va">todo</span>.<span class="at">completed</span></a>
<a class="sourceLine" id="cb24-4" title="4">)</a></code></pre></div>
<p>The following state update function <strong>will not</strong> work with <code>isFirstTodoCompleteSelector</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">todos</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-3" title="3">  <span class="cf">case</span> <span class="dt">COMPLETE_ALL</span><span class="op">:</span></a>
<a class="sourceLine" id="cb25-4" title="4">    <span class="kw">const</span> areAllMarked <span class="op">=</span> <span class="va">state</span>.<span class="at">every</span>(todo <span class="kw">=&gt;</span> <span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb25-5" title="5">    <span class="co">// BAD: mutating an existing object</span></a>
<a class="sourceLine" id="cb25-6" title="6">    <span class="cf">return</span> <span class="va">state</span>.<span class="at">map</span>(todo <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-7" title="7">      <span class="va">todo</span>.<span class="at">completed</span> <span class="op">=</span> <span class="op">!</span>areAllMarked</a>
<a class="sourceLine" id="cb25-8" title="8">      <span class="cf">return</span> todo</a>
<a class="sourceLine" id="cb25-9" title="9">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb25-10" title="10"></a>
<a class="sourceLine" id="cb25-11" title="11">  <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb25-12" title="12">    <span class="cf">return</span> state</a>
<a class="sourceLine" id="cb25-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb25-14" title="14"><span class="op">}</span></a></code></pre></div>
<p>The following state update function <strong>will</strong> work with <code>isFirstTodoCompleteSelector</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">todos</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-3" title="3">  <span class="cf">case</span> <span class="dt">COMPLETE_ALL</span><span class="op">:</span></a>
<a class="sourceLine" id="cb26-4" title="4">    <span class="kw">const</span> areAllMarked <span class="op">=</span> <span class="va">state</span>.<span class="at">every</span>(todo <span class="kw">=&gt;</span> <span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb26-5" title="5">    <span class="co">// GOOD: returning a new object each time with Object.assign</span></a>
<a class="sourceLine" id="cb26-6" title="6">    <span class="cf">return</span> <span class="va">state</span>.<span class="at">map</span>(todo <span class="kw">=&gt;</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> todo<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb26-7" title="7">      <span class="dt">completed</span><span class="op">:</span> <span class="op">!</span>areAllMarked</a>
<a class="sourceLine" id="cb26-8" title="8">    <span class="op">}</span>))</a>
<a class="sourceLine" id="cb26-9" title="9"></a>
<a class="sourceLine" id="cb26-10" title="10">  <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb26-11" title="11">    <span class="cf">return</span> state</a>
<a class="sourceLine" id="cb26-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb26-13" title="13"><span class="op">}</span></a></code></pre></div>
<p>If you are not using Redux and have a requirement to work with mutable data, you can use <code>createSelectorCreator</code> to replace the default memoization function and/or use a different equality check function. See <a href="#use-memoize-function-from-lodash-for-an-unbounded-cache">here</a> and <a href="#customize-equalitycheck-for-defaultmemoize">here</a> for examples.</p>
<h3 id="q-why-is-my-selector-recomputing-when-the-input-state-stays-the-same">Q: Why is my selector recomputing when the input state stays the same?</h3>
<p>A: Check that your memoization function is compatible with your state update function (i.e. the reducer if you are using Redux). For example, a selector created with <code>createSelector</code> that recomputes unexpectedly may be receiving a new object on each update whether the values it contains have changed or not. <code>createSelector</code> uses an identity check (<code>===</code>) to detect that an input has changed, so returning a new object on each update means that the selector will recompute on each update.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1"><span class="im">import</span> <span class="op">{</span> REMOVE_OLD <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../constants/ActionTypes&#39;</span></a>
<a class="sourceLine" id="cb27-2" title="2"></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="kw">const</span> initialState <span class="op">=</span> [</a>
<a class="sourceLine" id="cb27-4" title="4">  <span class="op">{</span></a>
<a class="sourceLine" id="cb27-5" title="5">    <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Use Redux&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-6" title="6">    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-7" title="7">    <span class="dt">id</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-8" title="8">    <span class="dt">timestamp</span><span class="op">:</span> <span class="va">Date</span>.<span class="at">now</span>()</a>
<a class="sourceLine" id="cb27-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb27-10" title="10">]</a>
<a class="sourceLine" id="cb27-11" title="11"></a>
<a class="sourceLine" id="cb27-12" title="12"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">todos</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-13" title="13">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-14" title="14">  <span class="cf">case</span> <span class="dt">REMOVE_OLD</span><span class="op">:</span></a>
<a class="sourceLine" id="cb27-15" title="15">    <span class="cf">return</span> <span class="va">state</span>.<span class="at">filter</span>(todo <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb27-16" title="16">      <span class="cf">return</span> <span class="va">todo</span>.<span class="at">timestamp</span> <span class="op">+</span> <span class="dv">30</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">&gt;</span> <span class="va">Date</span>.<span class="at">now</span>()</a>
<a class="sourceLine" id="cb27-17" title="17">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb27-18" title="18">  <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb27-19" title="19">    <span class="cf">return</span> state</a>
<a class="sourceLine" id="cb27-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb27-21" title="21"><span class="op">}</span></a></code></pre></div>
<p>The following selector is going to recompute every time REMOVE_OLD is invoked because Array.filter always returns a new object. However, in the majority of cases the REMOVE_OLD action will not change the list of todos so the recomputation is unnecessary.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb28-2" title="2"></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="kw">const</span> todosSelector <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">todos</span></a>
<a class="sourceLine" id="cb28-4" title="4"></a>
<a class="sourceLine" id="cb28-5" title="5"><span class="im">export</span> <span class="kw">const</span> visibleTodosSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb28-6" title="6">  todosSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb28-7" title="7">  (todos) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb28-8" title="8">    ...</a>
<a class="sourceLine" id="cb28-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb28-10" title="10">)</a></code></pre></div>
<p>You can eliminate unnecessary recomputations by returning a new object from the state update function only when a deep equality check has found that the list of todos has actually changed:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1"><span class="im">import</span> <span class="op">{</span> REMOVE_OLD <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../constants/ActionTypes&#39;</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="im">import</span> isEqual <span class="im">from</span> <span class="st">&#39;lodash.isEqual&#39;</span></a>
<a class="sourceLine" id="cb29-3" title="3"></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="kw">const</span> initialState <span class="op">=</span> [</a>
<a class="sourceLine" id="cb29-5" title="5">  <span class="op">{</span></a>
<a class="sourceLine" id="cb29-6" title="6">    <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Use Redux&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-7" title="7">    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-8" title="8">    <span class="dt">id</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-9" title="9">    <span class="dt">timestamp</span><span class="op">:</span> <span class="va">Date</span>.<span class="at">now</span>()</a>
<a class="sourceLine" id="cb29-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb29-11" title="11">]</a>
<a class="sourceLine" id="cb29-12" title="12"></a>
<a class="sourceLine" id="cb29-13" title="13"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">todos</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-14" title="14">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-15" title="15">  <span class="cf">case</span> <span class="dt">REMOVE_OLD</span><span class="op">:</span></a>
<a class="sourceLine" id="cb29-16" title="16">    <span class="kw">const</span> updatedState <span class="op">=</span>  <span class="va">state</span>.<span class="at">filter</span>(todo <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-17" title="17">      <span class="cf">return</span> <span class="va">todo</span>.<span class="at">timestamp</span> <span class="op">+</span> <span class="dv">30</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">&gt;</span> <span class="va">Date</span>.<span class="at">now</span>()</a>
<a class="sourceLine" id="cb29-18" title="18">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb29-19" title="19">    <span class="cf">return</span> <span class="at">isEqual</span>(updatedState<span class="op">,</span> state) <span class="op">?</span> state : updatedState</a>
<a class="sourceLine" id="cb29-20" title="20">  <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb29-21" title="21">    <span class="cf">return</span> state</a>
<a class="sourceLine" id="cb29-22" title="22">  <span class="op">}</span></a>
<a class="sourceLine" id="cb29-23" title="23"><span class="op">}</span></a></code></pre></div>
<p>Alternatively, the default <code>equalityCheck</code> function in the selector can be replaced by a deep equality check:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelectorCreator<span class="op">,</span> defaultMemoize <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb30-2" title="2"><span class="im">import</span> isEqual <span class="im">from</span> <span class="st">&#39;lodash.isEqual&#39;</span></a>
<a class="sourceLine" id="cb30-3" title="3"></a>
<a class="sourceLine" id="cb30-4" title="4"><span class="kw">const</span> todosSelector <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">todos</span></a>
<a class="sourceLine" id="cb30-5" title="5"></a>
<a class="sourceLine" id="cb30-6" title="6"><span class="co">// create a &quot;selector creator&quot; that uses lodash.isEqual instead of ===</span></a>
<a class="sourceLine" id="cb30-7" title="7"><span class="kw">const</span> createDeepEqualSelector <span class="op">=</span> <span class="at">createSelectorCreator</span>(</a>
<a class="sourceLine" id="cb30-8" title="8">  defaultMemoize<span class="op">,</span></a>
<a class="sourceLine" id="cb30-9" title="9">  isEqual</a>
<a class="sourceLine" id="cb30-10" title="10">)</a>
<a class="sourceLine" id="cb30-11" title="11"></a>
<a class="sourceLine" id="cb30-12" title="12"><span class="co">// use the new &quot;selector creator&quot; to create a selector</span></a>
<a class="sourceLine" id="cb30-13" title="13"><span class="kw">const</span> mySelector <span class="op">=</span> <span class="at">createDeepEqualSelector</span>(</a>
<a class="sourceLine" id="cb30-14" title="14">  todosSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb30-15" title="15">  (todos) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-16" title="16">    ...</a>
<a class="sourceLine" id="cb30-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb30-18" title="18">)</a></code></pre></div>
<p>Always check that the cost of an alternative <code>equalityCheck</code> function or deep equality check in the state update function is not greater than the cost of recomputing every time. If recomputing every time does work out to be the cheaper option, it may be that for this case Reselect is not giving you any benefit over passing a plain <code>mapStateToProps</code> function to <code>connect</code>.</p>
<h3 id="q-can-i-use-reselect-without-redux">Q: Can I use Reselect without Redux?</h3>
<p>A: Yes. Reselect has no dependencies on any other package, so although it was designed to be used with Redux it can be used independently. It is currently being used successfully in traditional Flux apps.</p>
<blockquote>
<p>If you create selectors using <code>createSelector</code> make sure its arguments are immutable. See <a href="#createselectorinputselectors--inputselectors-resultfunc">here</a></p>
</blockquote>
<h3 id="q-how-do-i-create-a-selector-that-takes-an-argument">Q: How do I create a selector that takes an argument?</h3>
<p>A: Keep in mind that selectors can access React props, so if your arguments are (or can be made available as) React props, you can use that functionality. <a href="#accessing-react-props-in-selectors">See here</a> for details.</p>
<p>Otherwise, Reselect doesn’t have built-in support for creating selectors that accepts arguments, but here are some suggestions for implementing similar functionality…</p>
<p>If the argument is not dynamic you can use a factory function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">const</span> expensiveItemSelectorFactory <span class="op">=</span> minValue <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb31-2" title="2">  <span class="cf">return</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb31-3" title="3">    shopItemsSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb31-4" title="4">    items <span class="kw">=&gt;</span> <span class="va">items</span>.<span class="at">filter</span>(item <span class="kw">=&gt;</span> <span class="va">item</span>.<span class="at">value</span> <span class="op">&gt;</span> minValue)</a>
<a class="sourceLine" id="cb31-5" title="5">  )</a>
<a class="sourceLine" id="cb31-6" title="6"><span class="op">}</span></a>
<a class="sourceLine" id="cb31-7" title="7"></a>
<a class="sourceLine" id="cb31-8" title="8"><span class="kw">const</span> subtotalSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb31-9" title="9">  <span class="at">expensiveItemSelectorFactory</span>(<span class="dv">200</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb31-10" title="10">  items <span class="kw">=&gt;</span> <span class="va">items</span>.<span class="at">reduce</span>((acc<span class="op">,</span> item) <span class="kw">=&gt;</span> acc <span class="op">+</span> <span class="va">item</span>.<span class="at">value</span><span class="op">,</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb31-11" title="11">)</a></code></pre></div>
<p>The general consensus <a href="https://github.com/reduxjs/reselect/issues/38">here</a> and <a href="https://github.com/optimizely/nuclear-js/issues/14">over at nuclear-js</a> is that if a selector needs a dynamic argument, then that argument should probably be state in the store. If you decide that you do require a selector with a dynamic argument, then a selector that returns a memoized function may be suitable:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb32-1" title="1"><span class="im">import</span> <span class="op">{</span> createSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;reselect&#39;</span></a>
<a class="sourceLine" id="cb32-2" title="2"><span class="im">import</span> memoize <span class="im">from</span> <span class="st">&#39;lodash.memoize&#39;</span></a>
<a class="sourceLine" id="cb32-3" title="3"></a>
<a class="sourceLine" id="cb32-4" title="4"><span class="kw">const</span> expensiveSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb32-5" title="5">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">items</span><span class="op">,</span></a>
<a class="sourceLine" id="cb32-6" title="6">  items <span class="kw">=&gt;</span> <span class="at">memoize</span>(</a>
<a class="sourceLine" id="cb32-7" title="7">    minValue <span class="kw">=&gt;</span> <span class="va">items</span>.<span class="at">filter</span>(item <span class="kw">=&gt;</span> <span class="va">item</span>.<span class="at">value</span> <span class="op">&gt;</span> minValue)</a>
<a class="sourceLine" id="cb32-8" title="8">  )</a>
<a class="sourceLine" id="cb32-9" title="9">)</a>
<a class="sourceLine" id="cb32-10" title="10"></a>
<a class="sourceLine" id="cb32-11" title="11"><span class="kw">const</span> expensiveFilter <span class="op">=</span> <span class="at">expensiveSelector</span>(state)</a>
<a class="sourceLine" id="cb32-12" title="12"></a>
<a class="sourceLine" id="cb32-13" title="13"><span class="kw">const</span> slightlyExpensive <span class="op">=</span> <span class="at">expensiveFilter</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb32-14" title="14"><span class="kw">const</span> veryExpensive <span class="op">=</span> <span class="at">expensiveFilter</span>(<span class="dv">1000000</span>)</a></code></pre></div>
<h3 id="q-the-default-memoization-function-is-no-good-can-i-use-a-different-one">Q: The default memoization function is no good, can I use a different one?</h3>
<p>A: We think it works great for a lot of use cases, but sure. See <a href="#customize-equalitycheck-for-defaultmemoize">these examples</a>.</p>
<h3 id="q-how-do-i-test-a-selector">Q: How do I test a selector?</h3>
<p>A: For a given input, a selector should always produce the same output. For this reason they are simple to unit test.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">const</span> selector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb33-2" title="2">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">a</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-3" title="3">  state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">b</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-4" title="4">  (a<span class="op">,</span> b) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb33-5" title="5">    <span class="dt">c</span><span class="op">:</span> a <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-6" title="6">    <span class="dt">d</span><span class="op">:</span> b <span class="op">*</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb33-7" title="7">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb33-8" title="8">)</a>
<a class="sourceLine" id="cb33-9" title="9"></a>
<a class="sourceLine" id="cb33-10" title="10"><span class="at">test</span>(<span class="st">&quot;selector unit test&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-11" title="11">  <span class="va">assert</span>.<span class="at">deepEqual</span>(<span class="at">selector</span>(<span class="op">{</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span>)<span class="op">,</span> <span class="op">{</span> <span class="dt">c</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">6</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb33-12" title="12">  <span class="va">assert</span>.<span class="at">deepEqual</span>(<span class="at">selector</span>(<span class="op">{</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">3</span> <span class="op">}</span>)<span class="op">,</span> <span class="op">{</span> <span class="dt">c</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">9</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb33-13" title="13"><span class="op">}</span>)</a></code></pre></div>
<p>It may also be useful to check that the memoization function for a selector works correctly with the state update function (i.e. the reducer if you are using Redux). Each selector has a <code>recomputations</code> method that will return the number of times it has been recomputed:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb34-1" title="1"><span class="at">suite</span>(<span class="st">&#39;selector&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb34-2" title="2">  <span class="kw">let</span> state <span class="op">=</span> <span class="op">{</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb34-3" title="3"></a>
<a class="sourceLine" id="cb34-4" title="4">  <span class="kw">const</span> reducer <span class="op">=</span> (state<span class="op">,</span> action) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb34-5" title="5">    <span class="op">{</span></a>
<a class="sourceLine" id="cb34-6" title="6">      <span class="dt">a</span><span class="op">:</span> <span class="at">action</span>(<span class="va">state</span>.<span class="at">a</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb34-7" title="7">      <span class="dt">b</span><span class="op">:</span> <span class="at">action</span>(<span class="va">state</span>.<span class="at">b</span>)</a>
<a class="sourceLine" id="cb34-8" title="8">    <span class="op">}</span></a>
<a class="sourceLine" id="cb34-9" title="9">  )</a>
<a class="sourceLine" id="cb34-10" title="10"></a>
<a class="sourceLine" id="cb34-11" title="11">  <span class="kw">const</span> selector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb34-12" title="12">    state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">a</span><span class="op">,</span></a>
<a class="sourceLine" id="cb34-13" title="13">    state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">b</span><span class="op">,</span></a>
<a class="sourceLine" id="cb34-14" title="14">    (a<span class="op">,</span> b) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb34-15" title="15">      <span class="dt">c</span><span class="op">:</span> a <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb34-16" title="16">      <span class="dt">d</span><span class="op">:</span> b <span class="op">*</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb34-17" title="17">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb34-18" title="18">  )</a>
<a class="sourceLine" id="cb34-19" title="19"></a>
<a class="sourceLine" id="cb34-20" title="20">  <span class="kw">const</span> plusOne <span class="op">=</span> x <span class="kw">=&gt;</span> x <span class="op">+</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb34-21" title="21">  <span class="kw">const</span> id <span class="op">=</span> x <span class="kw">=&gt;</span> x</a>
<a class="sourceLine" id="cb34-22" title="22"></a>
<a class="sourceLine" id="cb34-23" title="23">  <span class="at">test</span>(<span class="st">&quot;selector unit test&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb34-24" title="24">    state <span class="op">=</span> <span class="at">reducer</span>(state<span class="op">,</span> plusOne)</a>
<a class="sourceLine" id="cb34-25" title="25">    <span class="va">assert</span>.<span class="at">deepEqual</span>(<span class="at">selector</span>(state)<span class="op">,</span> <span class="op">{</span> <span class="dt">c</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">9</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb34-26" title="26">    state <span class="op">=</span> <span class="at">reducer</span>(state<span class="op">,</span> id)</a>
<a class="sourceLine" id="cb34-27" title="27">    <span class="va">assert</span>.<span class="at">deepEqual</span>(<span class="at">selector</span>(state)<span class="op">,</span> <span class="op">{</span> <span class="dt">c</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">9</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb34-28" title="28">    <span class="va">assert</span>.<span class="at">equal</span>(<span class="va">selector</span>.<span class="at">recomputations</span>()<span class="op">,</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb34-29" title="29">    state <span class="op">=</span> <span class="at">reducer</span>(state<span class="op">,</span> plusOne)</a>
<a class="sourceLine" id="cb34-30" title="30">    <span class="va">assert</span>.<span class="at">deepEqual</span>(<span class="at">selector</span>(state)<span class="op">,</span> <span class="op">{</span> <span class="dt">c</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">12</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb34-31" title="31">    <span class="va">assert</span>.<span class="at">equal</span>(<span class="va">selector</span>.<span class="at">recomputations</span>()<span class="op">,</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb34-32" title="32">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb34-33" title="33"><span class="op">}</span>)</a></code></pre></div>
<p>Additionally, selectors keep a reference to the last result function as <code>.resultFunc</code>. If you have selectors composed of many other selectors this can help you test each selector without coupling all of your tests to the shape of your state.</p>
<p>For example if you have a set of selectors like this:</p>
<p><strong>selectors.js</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb35-1" title="1"><span class="im">export</span> <span class="kw">const</span> firstSelector <span class="op">=</span> <span class="at">createSelector</span>( ... )</a>
<a class="sourceLine" id="cb35-2" title="2"><span class="im">export</span> <span class="kw">const</span> secondSelector <span class="op">=</span> <span class="at">createSelector</span>( ... )</a>
<a class="sourceLine" id="cb35-3" title="3"><span class="im">export</span> <span class="kw">const</span> thirdSelector <span class="op">=</span> <span class="at">createSelector</span>( ... )</a>
<a class="sourceLine" id="cb35-4" title="4"></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="im">export</span> <span class="kw">const</span> myComposedSelector <span class="op">=</span> <span class="at">createSelector</span>(</a>
<a class="sourceLine" id="cb35-6" title="6">  firstSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb35-7" title="7">  secondSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb35-8" title="8">  thirdSelector<span class="op">,</span></a>
<a class="sourceLine" id="cb35-9" title="9">  (first<span class="op">,</span> second<span class="op">,</span> third) <span class="kw">=&gt;</span> first <span class="op">*</span> second <span class="op">&lt;</span> third</a>
<a class="sourceLine" id="cb35-10" title="10">)</a></code></pre></div>
<p>And then a set of unit tests like this:</p>
<p><strong>test/selectors.js</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb36-1" title="1"><span class="co">// tests for the first three selectors...</span></a>
<a class="sourceLine" id="cb36-2" title="2"><span class="at">test</span>(<span class="st">&quot;firstSelector unit test&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span> ... <span class="op">}</span>)</a>
<a class="sourceLine" id="cb36-3" title="3"><span class="at">test</span>(<span class="st">&quot;secondSelector unit test&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span> ... <span class="op">}</span>)</a>
<a class="sourceLine" id="cb36-4" title="4"><span class="at">test</span>(<span class="st">&quot;thirdSelector unit test&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span> ... <span class="op">}</span>)</a>
<a class="sourceLine" id="cb36-5" title="5"></a>
<a class="sourceLine" id="cb36-6" title="6"><span class="co">// We have already tested the previous</span></a>
<a class="sourceLine" id="cb36-7" title="7"><span class="co">// three selector outputs so we can just call `.resultFunc`</span></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="co">// with the values we want to test directly:</span></a>
<a class="sourceLine" id="cb36-9" title="9"><span class="at">test</span>(<span class="st">&quot;myComposedSelector unit test&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb36-10" title="10">  <span class="co">// here instead of calling selector()</span></a>
<a class="sourceLine" id="cb36-11" title="11">  <span class="co">// we just call selector.resultFunc()</span></a>
<a class="sourceLine" id="cb36-12" title="12">  <span class="at">assert</span>(<span class="va">myComposedSelector</span>.<span class="at">resultFunc</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">,</span> <span class="kw">true</span>)</a>
<a class="sourceLine" id="cb36-13" title="13">  <span class="at">assert</span>(<span class="va">myComposedSelector</span>.<span class="at">resultFunc</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb36-14" title="14"><span class="op">}</span>)</a></code></pre></div>
<p>Finally, each selector has a <code>resetRecomputations</code> method that sets recomputations back to 0. The intended use is for a complex selector that may have many independent tests and you don’t want to manually manage the computation count or create a “dummy” selector for each test.</p>
<h3 id="q-how-do-i-use-reselect-with-immutable.js">Q: How do I use Reselect with Immutable.js?</h3>
<p>A: Selectors created with <code>createSelector</code> should work just fine with Immutable.js data structures.</p>
<p>If your selector is recomputing and you don’t think the state has changed, make sure you are aware of which Immutable.js update methods <strong>always</strong> return a new object and which update methods only return a new object <strong>when the collection actually changes</strong>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb37-1" title="1"><span class="im">import</span> Immutable <span class="im">from</span> <span class="st">&#39;immutable&#39;</span></a>
<a class="sourceLine" id="cb37-2" title="2"></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="kw">let</span> myMap <span class="op">=</span> <span class="va">Immutable</span>.<span class="at">Map</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb37-4" title="4">  <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb37-5" title="5">  <span class="dt">b</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb37-6" title="6">  <span class="dt">c</span><span class="op">:</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb37-8" title="8"></a>
<a class="sourceLine" id="cb37-9" title="9"> <span class="co">// set, merge and others only return a new obj when update changes collection</span></a>
<a class="sourceLine" id="cb37-10" title="10"><span class="kw">let</span> newMap <span class="op">=</span> <span class="va">myMap</span>.<span class="at">set</span>(<span class="st">&#39;a&#39;</span><span class="op">,</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb37-11" title="11"><span class="va">assert</span>.<span class="at">equal</span>(myMap<span class="op">,</span> newMap)</a>
<a class="sourceLine" id="cb37-12" title="12">newMap <span class="op">=</span> <span class="va">myMap</span>.<span class="at">merge</span>(<span class="op">{</span> <span class="st">&#39;a&#39;</span><span class="op">:</span> <span class="dv">1</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb37-13" title="13"><span class="va">assert</span>.<span class="at">equal</span>(myMap<span class="op">,</span> newMap)</a>
<a class="sourceLine" id="cb37-14" title="14"><span class="co">// map, reduce, filter and others always return a new obj</span></a>
<a class="sourceLine" id="cb37-15" title="15">newMap <span class="op">=</span> <span class="va">myMap</span>.<span class="at">map</span>(a <span class="kw">=&gt;</span> a <span class="op">*</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb37-16" title="16"><span class="va">assert</span>.<span class="at">notEqual</span>(myMap<span class="op">,</span> newMap)</a></code></pre></div>
<p>If a selector’s input is updated by an operation that always returns a new object, it may be performing unnecessary recomputations. See <a href="#q-why-is-my-selector-recomputing-when-the-input-state-stays-the-same">here</a> for a discussion on the pros and cons of using a deep equality check like <code>Immutable.is</code> to eliminate unnecessary recomputations.</p>
<h3 id="q-can-i-share-a-selector-across-multiple-component-instances">Q: Can I share a selector across multiple component instances?</h3>
<p>A: Selectors created using <code>createSelector</code> only have a cache size of one. This can make them unsuitable for sharing across multiple instances if the arguments to the selector are different for each instance of the component. There are a couple of ways to get around this:</p>
<ul>
<li><p>Create a factory function which returns a new selector for each instance of the component. There is built-in support for factory functions in React Redux v4.3 or higher. See <a href="#sharing-selectors-with-props-across-multiple-component-instances">here</a> for an example.</p></li>
<li><p>Create a custom selector with a cache size greater than one.</p></li>
</ul>
<h3 id="q-are-there-typescript-typings">Q: Are there TypeScript Typings?</h3>
<p>A: Yes! They are included and referenced in <code>package.json</code>. They should Just Work™.</p>
<h3 id="q-how-can-i-make-a-curried-selector">Q: How can I make a <a href="https://github.com/hemanth/functional-programming-jargon#currying">curried</a> selector?</h3>
<p>A: Try these <a href="https://github.com/reduxjs/reselect/issues/159#issuecomment-238724788">helper functions</a> courtesy of <a href="https://github.com/MattSPalmer">MattSPalmer</a></p>
<h2 id="related-projects">Related Projects</h2>
<h3 id="re-reselect"><a href="https://github.com/toomuchdesign/re-reselect">re-reselect</a></h3>
<p>Enhances Reselect selectors by wrapping <code>createSelector</code> and returning a memoized collection of selectors indexed with the cache key returned by a custom resolver function.</p>
<p>Useful to reduce selectors recalculation when the same selector is repeatedly called with one/few different arguments.</p>
<h3 id="reselect-tools"><a href="https://github.com/skortchmark9/reselect-tools">reselect-tools</a></h3>
<p><a href="https://chrome.google.com/webstore/detail/reselect-devtools/cjmaipngmabglflfeepmdiffcijhjlbb?hl=en">Chrome extension</a> and <a href="https://github.com/skortchmark9/reselect-tools">companion lib</a> for debugging selectors.</p>
<ul>
<li>Measure selector recomputations across the app and identify performance bottlenecks</li>
<li>Check selector dependencies, inputs, outputs, and recomputations at any time with the chrome extension</li>
<li>Statically export a JSON representation of your selector graph for further analysis</li>
</ul>
<h3 id="reselect-map"><a href="https://github.com/HeyImAlex/reselect-map">reselect-map</a></h3>
<p>Can be useful when doing <strong>very expensive</strong> computations on elements of a collection because Reselect might not give you the granularity of caching that you need. Check out the reselect-maps README for examples.</p>
<p><strong>The optimizations in reselect-map only apply in a small number of cases. If you are unsure whether you need it, you don’t!</strong></p>
<h2 id="license">License</h2>
<p>MIT</p>
</body>
</html>
