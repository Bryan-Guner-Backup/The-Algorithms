{
  "slug": "heap-generic",
  "name": "Heap Generic",
  "categories": ["datastructures", "heap"],
  "body": {},
  "implementations": {
    "python": {
      "dir": "data_structures/heap/heap_generic.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/data_structures/heap/heap_generic.py",
      "code": "<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Heap</span>:\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    A generic Heap class, can be used as min or max by passing the key function\n    accordingly.\n    &quot;&quot;&quot;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, key=<span class=\"hljs-literal\">None</span></span>):\n        <span class=\"hljs-comment\"># Stores actual heap items.</span>\n        self.arr = <span class=\"hljs-built_in\">list</span>()\n        <span class=\"hljs-comment\"># Stores indexes of each item for supporting updates and deletion.</span>\n        self.pos_map = {}\n        <span class=\"hljs-comment\"># Stores current size of heap.</span>\n        self.size = <span class=\"hljs-number\">0</span>\n        <span class=\"hljs-comment\"># Stores function used to evaluate the score of an item on which basis ordering</span>\n        <span class=\"hljs-comment\"># will be done.</span>\n        self.key = key <span class=\"hljs-keyword\">or</span> (<span class=\"hljs-keyword\">lambda</span> x: x)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_parent</span>(<span class=\"hljs-params\">self, i</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Returns parent index of given index if exists else None&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">int</span>((i - <span class=\"hljs-number\">1</span>) / <span class=\"hljs-number\">2</span>) <span class=\"hljs-keyword\">if</span> i &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_left</span>(<span class=\"hljs-params\">self, i</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Returns left-child-index of given index if exists else None&quot;&quot;&quot;</span>\n        left = <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">2</span> * i + <span class=\"hljs-number\">1</span>)\n        <span class=\"hljs-keyword\">return</span> left <span class=\"hljs-keyword\">if</span> <span class=\"hljs-number\">0</span> &lt; left &lt; self.size <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_right</span>(<span class=\"hljs-params\">self, i</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Returns right-child-index of given index if exists else None&quot;&quot;&quot;</span>\n        right = <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">2</span> * i + <span class=\"hljs-number\">2</span>)\n        <span class=\"hljs-keyword\">return</span> right <span class=\"hljs-keyword\">if</span> <span class=\"hljs-number\">0</span> &lt; right &lt; self.size <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_swap</span>(<span class=\"hljs-params\">self, i, j</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Performs changes required for swapping two elements in the heap&quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># First update the indexes of the items in index map.</span>\n        self.pos_map[self.arr[i][<span class=\"hljs-number\">0</span>]], self.pos_map[self.arr[j][<span class=\"hljs-number\">0</span>]] = (\n            self.pos_map[self.arr[j][<span class=\"hljs-number\">0</span>]],\n            self.pos_map[self.arr[i][<span class=\"hljs-number\">0</span>]],\n        )\n        <span class=\"hljs-comment\"># Then swap the items in the list.</span>\n        self.arr[i], self.arr[j] = self.arr[j], self.arr[i]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_cmp</span>(<span class=\"hljs-params\">self, i, j</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Compares the two items using default comparison&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> self.arr[i][<span class=\"hljs-number\">1</span>] &lt; self.arr[j][<span class=\"hljs-number\">1</span>]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_get_valid_parent</span>(<span class=\"hljs-params\">self, i</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        Returns index of valid parent as per desired ordering among given index and\n        both it&#x27;s children\n        &quot;&quot;&quot;</span>\n        left = self._left(i)\n        right = self._right(i)\n        valid_parent = i\n\n        <span class=\"hljs-keyword\">if</span> left <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> self._cmp(left, valid_parent):\n            valid_parent = left\n        <span class=\"hljs-keyword\">if</span> right <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> self._cmp(right, valid_parent):\n            valid_parent = right\n\n        <span class=\"hljs-keyword\">return</span> valid_parent\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_heapify_up</span>(<span class=\"hljs-params\">self, index</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Fixes the heap in upward direction of given index&quot;&quot;&quot;</span>\n        parent = self._parent(index)\n        <span class=\"hljs-keyword\">while</span> parent <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> self._cmp(index, parent):\n            self._swap(index, parent)\n            index, parent = parent, self._parent(parent)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_heapify_down</span>(<span class=\"hljs-params\">self, index</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Fixes the heap in downward direction of given index&quot;&quot;&quot;</span>\n        valid_parent = self._get_valid_parent(index)\n        <span class=\"hljs-keyword\">while</span> valid_parent != index:\n            self._swap(index, valid_parent)\n            index, valid_parent = valid_parent, self._get_valid_parent(valid_parent)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_item</span>(<span class=\"hljs-params\">self, item, item_value</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Updates given item value in heap if present&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">if</span> item <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> self.pos_map:\n            <span class=\"hljs-keyword\">return</span>\n        index = self.pos_map[item]\n        self.arr[index] = [item, self.key(item_value)]\n        <span class=\"hljs-comment\"># Make sure heap is right in both up and down direction.</span>\n        <span class=\"hljs-comment\"># Ideally only one of them will make any change.</span>\n        self._heapify_up(index)\n        self._heapify_down(index)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_item</span>(<span class=\"hljs-params\">self, item</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Deletes given item from heap if present&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">if</span> item <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> self.pos_map:\n            <span class=\"hljs-keyword\">return</span>\n        index = self.pos_map[item]\n        <span class=\"hljs-keyword\">del</span> self.pos_map[item]\n        self.arr[index] = self.arr[self.size - <span class=\"hljs-number\">1</span>]\n        self.pos_map[self.arr[self.size - <span class=\"hljs-number\">1</span>][<span class=\"hljs-number\">0</span>]] = index\n        self.size -= <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-comment\"># Make sure heap is right in both up and down direction. Ideally only one</span>\n        <span class=\"hljs-comment\"># of them will make any change- so no performance loss in calling both.</span>\n        <span class=\"hljs-keyword\">if</span> self.size &gt; index:\n            self._heapify_up(index)\n            self._heapify_down(index)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">insert_item</span>(<span class=\"hljs-params\">self, item, item_value</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Inserts given item with given value in heap&quot;&quot;&quot;</span>\n        arr_len = <span class=\"hljs-built_in\">len</span>(self.arr)\n        <span class=\"hljs-keyword\">if</span> arr_len == self.size:\n            self.arr.append([item, self.key(item_value)])\n        <span class=\"hljs-keyword\">else</span>:\n            self.arr[self.size] = [item, self.key(item_value)]\n        self.pos_map[item] = self.size\n        self.size += <span class=\"hljs-number\">1</span>\n        self._heapify_up(self.size - <span class=\"hljs-number\">1</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_top</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;Returns top item tuple (Calculated value, item) from heap if present&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> self.arr[<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">if</span> self.size <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">extract_top</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        Return top item tuple (Calculated value, item) from heap and removes it as well\n        if present\n        &quot;&quot;&quot;</span>\n        top_item_tuple = self.get_top()\n        <span class=\"hljs-keyword\">if</span> top_item_tuple:\n            self.delete_item(top_item_tuple[<span class=\"hljs-number\">0</span>])\n        <span class=\"hljs-keyword\">return</span> top_item_tuple\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_heap</span>() -&gt; <span class=\"hljs-literal\">None</span>:\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    &gt;&gt;&gt; h = Heap()  # Max-heap\n    &gt;&gt;&gt; h.insert_item(5, 34)\n    &gt;&gt;&gt; h.insert_item(6, 31)\n    &gt;&gt;&gt; h.insert_item(7, 37)\n    &gt;&gt;&gt; h.get_top()\n    [7, 37]\n    &gt;&gt;&gt; h.extract_top()\n    [7, 37]\n    &gt;&gt;&gt; h.extract_top()\n    [5, 34]\n    &gt;&gt;&gt; h.extract_top()\n    [6, 31]\n    &gt;&gt;&gt; h = Heap(key=lambda x: -x)  # Min heap\n    &gt;&gt;&gt; h.insert_item(5, 34)\n    &gt;&gt;&gt; h.insert_item(6, 31)\n    &gt;&gt;&gt; h.insert_item(7, 37)\n    &gt;&gt;&gt; h.get_top()\n    [6, -31]\n    &gt;&gt;&gt; h.extract_top()\n    [6, -31]\n    &gt;&gt;&gt; h.extract_top()\n    [5, -34]\n    &gt;&gt;&gt; h.extract_top()\n    [7, -37]\n    &gt;&gt;&gt; h.insert_item(8, 45)\n    &gt;&gt;&gt; h.insert_item(9, 40)\n    &gt;&gt;&gt; h.insert_item(10, 50)\n    &gt;&gt;&gt; h.get_top()\n    [9, -40]\n    &gt;&gt;&gt; h.update_item(10, 30)\n    &gt;&gt;&gt; h.get_top()\n    [10, -30]\n    &gt;&gt;&gt; h.delete_item(10)\n    &gt;&gt;&gt; h.get_top()\n    [9, -40]\n    &quot;&quot;&quot;</span>\n    <span class=\"hljs-keyword\">pass</span>\n\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    <span class=\"hljs-keyword\">import</span> doctest\n\n    doctest.testmod()\n"
    }
  },
  "contributors": [
    {
      "name": "Níkolas Vargas",
      "email": "vargasnikolass@gmail.com",
      "commits": 1
    },
    {
      "name": "Saurabh Goyal",
      "email": "saurabh.2561@gmail.com",
      "commits": 1
    },
    {
      "name": "Christian Clauss",
      "email": "cclauss@me.com",
      "commits": 2
    }
  ],
  "explanationUrl": {}
}
