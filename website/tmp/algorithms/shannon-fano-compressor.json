{
  "slug": "shannon-fano-compressor",
  "name": "Shannon-Fano Compressor",
  "categories": ["datastructures", "linkedlist"],
  "body": {},
  "implementations": {
    "c-sharp": {
      "dir": "Algorithms/DataCompression/ShannonFanoCompressor.cs",
      "url": "https://github.com/TheAlgorithms/C-Sharp/blob/master/Algorithms/DataCompression/ShannonFanoCompressor.cs",
      "code": "<span class=\"hljs-keyword\">using</span> System.Collections.Generic;\n<span class=\"hljs-keyword\">using</span> System.Linq;\n<span class=\"hljs-keyword\">using</span> Algorithms.Knapsack;\n<span class=\"hljs-keyword\">using</span> Utilities.Extensions;\n\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">Algorithms.DataCompression</span>\n{\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span>     Greedy lossless compression algorithm.</span>\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ShannonFanoCompressor</span>\n    {\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> IHeuristicKnapsackSolver&lt;(<span class=\"hljs-built_in\">char</span> symbol, <span class=\"hljs-built_in\">double</span> frequency)&gt; splitter;\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> Translator translator;\n\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">ShannonFanoCompressor</span>(<span class=\"hljs-params\">\n            IHeuristicKnapsackSolver&lt;(<span class=\"hljs-built_in\">char</span> symbol, <span class=\"hljs-built_in\">double</span> frequency</span>)&gt; splitter,\n            Translator translator)</span>\n        {\n            <span class=\"hljs-keyword\">this</span>.splitter = splitter;\n            <span class=\"hljs-keyword\">this</span>.translator = translator;\n        }\n\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span>     Given an input string, returns a new compressed string</span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span>     using Shannon-Fano encoding.</span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;param name=&quot;uncompressedText&quot;&gt;</span>Text message to compress.<span class=\"hljs-doctag\">&lt;/param&gt;</span></span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;returns&gt;</span>Compressed string and keys to decompress it.<span class=\"hljs-doctag\">&lt;/returns&gt;</span></span>\n        <span class=\"hljs-keyword\">public</span> (<span class=\"hljs-built_in\">string</span> compressedText, Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt; decompressionKeys) Compress(<span class=\"hljs-built_in\">string</span> uncompressedText)\n        {\n            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">string</span>.IsNullOrEmpty(uncompressedText))\n            {\n                <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-built_in\">string</span>.Empty, <span class=\"hljs-keyword\">new</span> Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt;());\n            }\n\n            <span class=\"hljs-keyword\">if</span> (uncompressedText.Distinct().Count() == <span class=\"hljs-number\">1</span>)\n            {\n                <span class=\"hljs-keyword\">var</span> dict = <span class=\"hljs-keyword\">new</span> Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt;\n                {\n                    { <span class=\"hljs-string\">&quot;1&quot;</span>, uncompressedText[<span class=\"hljs-number\">0</span>].ToString() },\n                };\n                <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">string</span>(<span class=\"hljs-string\">&#x27;1&#x27;</span>, uncompressedText.Length), dict);\n            }\n\n            <span class=\"hljs-keyword\">var</span> node = GetListNodeFromText(uncompressedText);\n            <span class=\"hljs-keyword\">var</span> tree = GenerateShannonFanoTree(node);\n            <span class=\"hljs-keyword\">var</span> (compressionKeys, decompressionKeys) = GetKeys(tree);\n            <span class=\"hljs-keyword\">return</span> (translator.Translate(uncompressedText, compressionKeys), decompressionKeys);\n        }\n\n        <span class=\"hljs-keyword\">private</span> (Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt; compressionKeys, Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt; decompressionKeys) GetKeys(\n            ListNode tree)\n        {\n            <span class=\"hljs-keyword\">var</span> compressionKeys = <span class=\"hljs-keyword\">new</span> Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt;();\n            <span class=\"hljs-keyword\">var</span> decompressionKeys = <span class=\"hljs-keyword\">new</span> Dictionary&lt;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>&gt;();\n\n            <span class=\"hljs-keyword\">if</span> (tree.Data.Length == <span class=\"hljs-number\">1</span>)\n            {\n                compressionKeys.Add(tree.Data[<span class=\"hljs-number\">0</span>].symbol.ToString(), <span class=\"hljs-built_in\">string</span>.Empty);\n                decompressionKeys.Add(<span class=\"hljs-built_in\">string</span>.Empty, tree.Data[<span class=\"hljs-number\">0</span>].symbol.ToString());\n                <span class=\"hljs-keyword\">return</span> (compressionKeys, decompressionKeys);\n            }\n\n            <span class=\"hljs-keyword\">if</span> (tree.LeftChild <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">null</span>)\n            {\n                <span class=\"hljs-keyword\">var</span> (lsck, lsdk) = GetKeys(tree.LeftChild);\n                compressionKeys.AddMany(lsck.Select(kvp =&gt; (kvp.Key, <span class=\"hljs-string\">&quot;0&quot;</span> + kvp.Value)));\n                decompressionKeys.AddMany(lsdk.Select(kvp =&gt; (<span class=\"hljs-string\">&quot;0&quot;</span> + kvp.Key, kvp.Value)));\n            }\n\n            <span class=\"hljs-keyword\">if</span> (tree.RightChild <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">null</span>)\n            {\n                <span class=\"hljs-keyword\">var</span> (rsck, rsdk) = GetKeys(tree.RightChild);\n                compressionKeys.AddMany(rsck.Select(kvp =&gt; (kvp.Key, <span class=\"hljs-string\">&quot;1&quot;</span> + kvp.Value)));\n                decompressionKeys.AddMany(rsdk.Select(kvp =&gt; (<span class=\"hljs-string\">&quot;1&quot;</span> + kvp.Key, kvp.Value)));\n            }\n\n            <span class=\"hljs-keyword\">return</span> (compressionKeys, decompressionKeys);\n        }\n\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> ListNode <span class=\"hljs-title\">GenerateShannonFanoTree</span>(<span class=\"hljs-params\">ListNode node</span>)</span>\n        {\n            <span class=\"hljs-keyword\">if</span> (node.Data.Length == <span class=\"hljs-number\">1</span>)\n            {\n                <span class=\"hljs-keyword\">return</span> node;\n            }\n\n            <span class=\"hljs-keyword\">var</span> left = splitter.Solve(node.Data, <span class=\"hljs-number\">0.5</span> * node.Data.Sum(x =&gt; x.frequency), x =&gt; x.frequency, x =&gt; <span class=\"hljs-number\">1</span>);\n            <span class=\"hljs-keyword\">var</span> right = node.Data.Except(left).ToArray();\n\n            node.LeftChild = GenerateShannonFanoTree(<span class=\"hljs-keyword\">new</span> ListNode(left));\n            node.RightChild = GenerateShannonFanoTree(<span class=\"hljs-keyword\">new</span> ListNode(right));\n\n            <span class=\"hljs-keyword\">return</span> node;\n        }\n\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span>     Finds frequency for each character in the text.</span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;returns&gt;</span>Symbol-frequency array.<span class=\"hljs-doctag\">&lt;/returns&gt;</span></span>\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> ListNode <span class=\"hljs-title\">GetListNodeFromText</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">string</span> text</span>)</span>\n        {\n            <span class=\"hljs-keyword\">var</span> occurenceCounts = <span class=\"hljs-keyword\">new</span> Dictionary&lt;<span class=\"hljs-built_in\">char</span>, <span class=\"hljs-built_in\">double</span>&gt;();\n\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; text.Length; i++)\n            {\n                <span class=\"hljs-keyword\">var</span> ch = text[i];\n                <span class=\"hljs-keyword\">if</span> (!occurenceCounts.ContainsKey(ch))\n                {\n                    occurenceCounts.Add(ch, <span class=\"hljs-number\">0</span>);\n                }\n\n                occurenceCounts[ch]++;\n            }\n\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> ListNode(occurenceCounts.Select(kvp =&gt; (kvp.Key, <span class=\"hljs-number\">1</span>d * kvp.Value / text.Length)).ToArray());\n        }\n\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span>     Represents tree structure for the algorithm.</span>\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ListNode</span>\n        {\n            <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">ListNode</span>(<span class=\"hljs-params\">(<span class=\"hljs-built_in\">char</span> symbol, <span class=\"hljs-built_in\">double</span> frequency</span>)[] data)</span> =&gt; Data = data;\n\n            <span class=\"hljs-keyword\">public</span> (<span class=\"hljs-built_in\">char</span> symbol, <span class=\"hljs-built_in\">double</span> frequency)[] Data { <span class=\"hljs-keyword\">get</span>; }\n\n            <span class=\"hljs-keyword\">public</span> ListNode? RightChild { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n\n            <span class=\"hljs-keyword\">public</span> ListNode? LeftChild { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n        }\n    }\n}\n"
    }
  },
  "contributors": [
    {
      "name": "Siddharth Kochar",
      "email": "sidkcr@gmail.com",
      "commits": 1
    },
    {
      "name": "Andrii Siriak",
      "email": "siryaka@gmail.com",
      "commits": 5
    }
  ],
  "explanationUrl": {}
}
