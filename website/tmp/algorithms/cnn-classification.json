{
  "slug": "cnn-classification",
  "name": "Cnn Classification",
  "categories": ["computervision"],
  "body": {},
  "implementations": {
    "python": {
      "dir": "computer_vision/cnn_classification.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/computer_vision/cnn_classification.py",
      "code": "<span class=\"hljs-string\">&quot;&quot;&quot;\nConvolutional Neural Network\n\nObjective : To train a CNN model detect if TB is present in Lung X-ray or not.\n\nResources CNN Theory :\n    https://en.wikipedia.org/wiki/Convolutional_neural_network\nResources Tensorflow : https://www.tensorflow.org/tutorials/images/cnn\n\nDownload dataset from :\nhttps://lhncbc.nlm.nih.gov/LHC-publications/pubs/TuberculosisChestXrayImageDataSets.html\n\n1. Download the dataset folder and create two folder training set and test set\nin the parent dataste folder\n2. Move 30-40 image from both TB positive and TB Negative folder\nin the test set folder\n3. The labels of the iamges will be extracted from the folder name\nthe image is present in.\n\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-comment\"># Part 1 - Building the CNN</span>\n\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n\n<span class=\"hljs-comment\"># Importing the Keras libraries and packages</span>\n<span class=\"hljs-keyword\">import</span> tensorflow <span class=\"hljs-keyword\">as</span> tf\n<span class=\"hljs-keyword\">from</span> tensorflow.keras <span class=\"hljs-keyword\">import</span> layers, models\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n\n    <span class=\"hljs-comment\"># Initialising the CNN</span>\n    classifier = models.Sequential()\n\n    <span class=\"hljs-comment\"># Step 1 - Convolution</span>\n    classifier.add(\n        layers.Conv2D(<span class=\"hljs-number\">32</span>, (<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>), input_shape=(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">3</span>), activation=<span class=\"hljs-string\">&quot;relu&quot;</span>)\n    )\n\n    <span class=\"hljs-comment\"># Step 2 - Pooling</span>\n    classifier.add(layers.MaxPooling2D(pool_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>)))\n\n    <span class=\"hljs-comment\"># Adding a second convolutional layer</span>\n    classifier.add(layers.Conv2D(<span class=\"hljs-number\">32</span>, (<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>), activation=<span class=\"hljs-string\">&quot;relu&quot;</span>))\n    classifier.add(layers.MaxPooling2D(pool_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>)))\n\n    <span class=\"hljs-comment\"># Step 3 - Flattening</span>\n    classifier.add(layers.Flatten())\n\n    <span class=\"hljs-comment\"># Step 4 - Full connection</span>\n    classifier.add(layers.Dense(units=<span class=\"hljs-number\">128</span>, activation=<span class=\"hljs-string\">&quot;relu&quot;</span>))\n    classifier.add(layers.Dense(units=<span class=\"hljs-number\">1</span>, activation=<span class=\"hljs-string\">&quot;sigmoid&quot;</span>))\n\n    <span class=\"hljs-comment\"># Compiling the CNN</span>\n    classifier.<span class=\"hljs-built_in\">compile</span>(\n        optimizer=<span class=\"hljs-string\">&quot;adam&quot;</span>, loss=<span class=\"hljs-string\">&quot;binary_crossentropy&quot;</span>, metrics=[<span class=\"hljs-string\">&quot;accuracy&quot;</span>]\n    )\n\n    <span class=\"hljs-comment\"># Part 2 - Fitting the CNN to the images</span>\n\n    <span class=\"hljs-comment\"># Load Trained model weights</span>\n\n    <span class=\"hljs-comment\"># from keras.models import load_model</span>\n    <span class=\"hljs-comment\"># regressor=load_model(&#x27;cnn.h5&#x27;)</span>\n\n    train_datagen = tf.keras.preprocessing.image.ImageDataGenerator(\n        rescale=<span class=\"hljs-number\">1.0</span> / <span class=\"hljs-number\">255</span>, shear_range=<span class=\"hljs-number\">0.2</span>, zoom_range=<span class=\"hljs-number\">0.2</span>, horizontal_flip=<span class=\"hljs-literal\">True</span>\n    )\n\n    test_datagen = tf.keras.preprocessing.image.ImageDataGenerator(rescale=<span class=\"hljs-number\">1.0</span> / <span class=\"hljs-number\">255</span>)\n\n    training_set = train_datagen.flow_from_directory(\n        <span class=\"hljs-string\">&quot;dataset/training_set&quot;</span>, target_size=(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">64</span>), batch_size=<span class=\"hljs-number\">32</span>, class_mode=<span class=\"hljs-string\">&quot;binary&quot;</span>\n    )\n\n    test_set = test_datagen.flow_from_directory(\n        <span class=\"hljs-string\">&quot;dataset/test_set&quot;</span>, target_size=(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">64</span>), batch_size=<span class=\"hljs-number\">32</span>, class_mode=<span class=\"hljs-string\">&quot;binary&quot;</span>\n    )\n\n    classifier.fit_generator(\n        training_set, steps_per_epoch=<span class=\"hljs-number\">5</span>, epochs=<span class=\"hljs-number\">30</span>, validation_data=test_set\n    )\n\n    classifier.save(<span class=\"hljs-string\">&quot;cnn.h5&quot;</span>)\n\n    <span class=\"hljs-comment\"># Part 3 - Making new predictions</span>\n\n    test_image = tf.keras.preprocessing.image.load_img(\n        <span class=\"hljs-string\">&quot;dataset/single_prediction/image.png&quot;</span>, target_size=(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">64</span>)\n    )\n    test_image = tf.keras.preprocessing.image.img_to_array(test_image)\n    test_image = np.expand_dims(test_image, axis=<span class=\"hljs-number\">0</span>)\n    result = classifier.predict(test_image)\n    training_set.class_indices\n    <span class=\"hljs-keyword\">if</span> result[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>] == <span class=\"hljs-number\">0</span>:\n        prediction = <span class=\"hljs-string\">&quot;Normal&quot;</span>\n    <span class=\"hljs-keyword\">if</span> result[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>] == <span class=\"hljs-number\">1</span>:\n        prediction = <span class=\"hljs-string\">&quot;Abnormality detected&quot;</span>\n"
    }
  },
  "contributors": [
    {
      "name": "Harshit Agarwal",
      "email": "43147421+9harshit@users.noreply.github.com",
      "commits": 1
    }
  ],
  "explanationUrl": {}
}
