{
  "slug": "lazy-segment-tree",
  "name": "Lazy Segment Tree",
  "categories": ["datastructures", "binarytree"],
  "body": {},
  "implementations": {
    "python": {
      "dir": "data_structures/binary_tree/lazy_segment_tree.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/data_structures/binary_tree/lazy_segment_tree.py",
      "code": "<span class=\"hljs-keyword\">from</span> __future__ <span class=\"hljs-keyword\">import</span> annotations\n\n<span class=\"hljs-keyword\">import</span> math\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>, <span class=\"hljs-type\">Union</span>\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SegmentTree</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, size: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:\n        self.size = size\n        <span class=\"hljs-comment\"># approximate the overall size of segment tree with given value</span>\n        self.segment_tree = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">4</span> * size)]\n        <span class=\"hljs-comment\"># create array to store lazy update</span>\n        self.lazy = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">4</span> * size)]\n        self.flag = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">4</span> * size)]  <span class=\"hljs-comment\"># flag for lazy update</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">left</span>(<span class=\"hljs-params\">self, idx: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &gt;&gt;&gt; segment_tree = SegmentTree(15)\n        &gt;&gt;&gt; segment_tree.left(1)\n        2\n        &gt;&gt;&gt; segment_tree.left(2)\n        4\n        &gt;&gt;&gt; segment_tree.left(12)\n        24\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> idx * <span class=\"hljs-number\">2</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">right</span>(<span class=\"hljs-params\">self, idx: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &gt;&gt;&gt; segment_tree = SegmentTree(15)\n        &gt;&gt;&gt; segment_tree.right(1)\n        3\n        &gt;&gt;&gt; segment_tree.right(2)\n        5\n        &gt;&gt;&gt; segment_tree.right(12)\n        25\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> idx * <span class=\"hljs-number\">2</span> + <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">build</span>(<span class=\"hljs-params\">\n        self, idx: <span class=\"hljs-built_in\">int</span>, left_element: <span class=\"hljs-built_in\">int</span>, right_element: <span class=\"hljs-built_in\">int</span>, A: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]\n    </span>) -&gt; <span class=\"hljs-literal\">None</span>:\n        <span class=\"hljs-keyword\">if</span> left_element == right_element:\n            self.segment_tree[idx] = A[left_element - <span class=\"hljs-number\">1</span>]\n        <span class=\"hljs-keyword\">else</span>:\n            mid = (left_element + right_element) // <span class=\"hljs-number\">2</span>\n            self.build(self.left(idx), left_element, mid, A)\n            self.build(self.right(idx), mid + <span class=\"hljs-number\">1</span>, right_element, A)\n            self.segment_tree[idx] = <span class=\"hljs-built_in\">max</span>(\n                self.segment_tree[self.left(idx)], self.segment_tree[self.right(idx)]\n            )\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update</span>(<span class=\"hljs-params\">\n        self, idx: <span class=\"hljs-built_in\">int</span>, left_element: <span class=\"hljs-built_in\">int</span>, right_element: <span class=\"hljs-built_in\">int</span>, a: <span class=\"hljs-built_in\">int</span>, b: <span class=\"hljs-built_in\">int</span>, val: <span class=\"hljs-built_in\">int</span>\n    </span>) -&gt; <span class=\"hljs-built_in\">bool</span>:\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        update with O(lg n) (Normal segment tree without lazy update will take O(nlg n)\n        for each update)\n\n        update(1, 1, size, a, b, v) for update val v to [a,b]\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">if</span> self.flag[idx] <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">True</span>:\n            self.segment_tree[idx] = self.lazy[idx]\n            self.flag[idx] = <span class=\"hljs-literal\">False</span>\n            <span class=\"hljs-keyword\">if</span> left_element != right_element:\n                self.lazy[self.left(idx)] = self.lazy[idx]\n                self.lazy[self.right(idx)] = self.lazy[idx]\n                self.flag[self.left(idx)] = <span class=\"hljs-literal\">True</span>\n                self.flag[self.right(idx)] = <span class=\"hljs-literal\">True</span>\n\n        <span class=\"hljs-keyword\">if</span> right_element &lt; a <span class=\"hljs-keyword\">or</span> left_element &gt; b:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span>\n        <span class=\"hljs-keyword\">if</span> left_element &gt;= a <span class=\"hljs-keyword\">and</span> right_element &lt;= b:\n            self.segment_tree[idx] = val\n            <span class=\"hljs-keyword\">if</span> left_element != right_element:\n                self.lazy[self.left(idx)] = val\n                self.lazy[self.right(idx)] = val\n                self.flag[self.left(idx)] = <span class=\"hljs-literal\">True</span>\n                self.flag[self.right(idx)] = <span class=\"hljs-literal\">True</span>\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span>\n        mid = (left_element + right_element) // <span class=\"hljs-number\">2</span>\n        self.update(self.left(idx), left_element, mid, a, b, val)\n        self.update(self.right(idx), mid + <span class=\"hljs-number\">1</span>, right_element, a, b, val)\n        self.segment_tree[idx] = <span class=\"hljs-built_in\">max</span>(\n            self.segment_tree[self.left(idx)], self.segment_tree[self.right(idx)]\n        )\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span>\n\n    <span class=\"hljs-comment\"># query with O(lg n)</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">query</span>(<span class=\"hljs-params\">\n        self, idx: <span class=\"hljs-built_in\">int</span>, left_element: <span class=\"hljs-built_in\">int</span>, right_element: <span class=\"hljs-built_in\">int</span>, a: <span class=\"hljs-built_in\">int</span>, b: <span class=\"hljs-built_in\">int</span>\n    </span>) -&gt; <span class=\"hljs-type\">Union</span>[<span class=\"hljs-built_in\">int</span>, <span class=\"hljs-built_in\">float</span>]:\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        query(1, 1, size, a, b) for query max of [a,b]\n        &gt;&gt;&gt; A = [1, 2, -4, 7, 3, -5, 6, 11, -20, 9, 14, 15, 5, 2, -8]\n        &gt;&gt;&gt; segment_tree = SegmentTree(15)\n        &gt;&gt;&gt; segment_tree.build(1, 1, 15, A)\n        &gt;&gt;&gt; segment_tree.query(1, 1, 15, 4, 6)\n        7\n        &gt;&gt;&gt; segment_tree.query(1, 1, 15, 7, 11)\n        14\n        &gt;&gt;&gt; segment_tree.query(1, 1, 15, 7, 12)\n        15\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">if</span> self.flag[idx] <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">True</span>:\n            self.segment_tree[idx] = self.lazy[idx]\n            self.flag[idx] = <span class=\"hljs-literal\">False</span>\n            <span class=\"hljs-keyword\">if</span> left_element != right_element:\n                self.lazy[self.left(idx)] = self.lazy[idx]\n                self.lazy[self.right(idx)] = self.lazy[idx]\n                self.flag[self.left(idx)] = <span class=\"hljs-literal\">True</span>\n                self.flag[self.right(idx)] = <span class=\"hljs-literal\">True</span>\n        <span class=\"hljs-keyword\">if</span> right_element &lt; a <span class=\"hljs-keyword\">or</span> left_element &gt; b:\n            <span class=\"hljs-keyword\">return</span> -math.inf\n        <span class=\"hljs-keyword\">if</span> left_element &gt;= a <span class=\"hljs-keyword\">and</span> right_element &lt;= b:\n            <span class=\"hljs-keyword\">return</span> self.segment_tree[idx]\n        mid = (left_element + right_element) // <span class=\"hljs-number\">2</span>\n        q1 = self.query(self.left(idx), left_element, mid, a, b)\n        q2 = self.query(self.right(idx), mid + <span class=\"hljs-number\">1</span>, right_element, a, b)\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">max</span>(q1, q2)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">str</span>:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">str</span>([self.query(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, self.size, i, i) <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, self.size + <span class=\"hljs-number\">1</span>)])\n\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    A = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, -<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">3</span>, -<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">11</span>, -<span class=\"hljs-number\">20</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">14</span>, <span class=\"hljs-number\">15</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">2</span>, -<span class=\"hljs-number\">8</span>]\n    size = <span class=\"hljs-number\">15</span>\n    segt = SegmentTree(size)\n    segt.build(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, A)\n    <span class=\"hljs-built_in\">print</span>(segt.query(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">6</span>))\n    <span class=\"hljs-built_in\">print</span>(segt.query(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">11</span>))\n    <span class=\"hljs-built_in\">print</span>(segt.query(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">12</span>))\n    segt.update(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">111</span>)\n    <span class=\"hljs-built_in\">print</span>(segt.query(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">15</span>))\n    segt.update(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, size, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">235</span>)\n    <span class=\"hljs-built_in\">print</span>(segt)\n"
    }
  },
  "contributors": [
    {
      "name": "AlexDvorak",
      "email": "opti.jawsome@gmail.com",
      "commits": 1
    },
    {
      "name": "Hao LI",
      "email": "8520588+Leo-LiHao@users.noreply.github.com",
      "commits": 1
    },
    {
      "name": "William Zhang",
      "email": "39932068+WilliamHYZhang@users.noreply.github.com",
      "commits": 1
    },
    {
      "name": "cclauss",
      "email": "cclauss@bluewin.ch",
      "commits": 1
    },
    {
      "name": "97arushisharma",
      "email": "97arushisharma@gmail.com",
      "commits": 1
    },
    {
      "name": "Sarot Busala",
      "email": "sabuza97@gmail.com",
      "commits": 1
    },
    {
      "name": "kanthuc",
      "email": "srikanthuchavali@gmail.com",
      "commits": 2
    },
    {
      "name": "Christian Clauss",
      "email": "cclauss@me.com",
      "commits": 4
    }
  ],
  "explanationUrl": {}
}
