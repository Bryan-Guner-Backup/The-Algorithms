{
  "slug": "matrix-exponentiation",
  "name": "Matrix Exponentiation",
  "categories": ["math"],
  "body": {},
  "implementations": {
    "python": {
      "dir": "maths/matrix_exponentiation.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/maths/matrix_exponentiation.py",
      "code": "<span class=\"hljs-string\">&quot;&quot;&quot;Matrix Exponentiation&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">import</span> timeit\n\n<span class=\"hljs-string\">&quot;&quot;&quot;\nMatrix Exponentiation is a technique to solve linear recurrences in logarithmic time.\nYou read more about it here:\nhttp://zobayer.blogspot.com/2010/11/matrix-exponentiation.html\nhttps://www.hackerearth.com/practice/notes/matrix-exponentiation-1/\n&quot;&quot;&quot;</span>\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Matrix</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, arg</span>):\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(arg, <span class=\"hljs-built_in\">list</span>):  <span class=\"hljs-comment\"># Initializes a matrix identical to the one provided.</span>\n            self.t = arg\n            self.n = <span class=\"hljs-built_in\">len</span>(arg)\n        <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># Initializes a square matrix of the given size and set values to zero.</span>\n            self.n = arg\n            self.t = [[<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.n)] <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.n)]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__mul__</span>(<span class=\"hljs-params\">self, b</span>):\n        matrix = Matrix(self.n)\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.n):\n            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.n):\n                <span class=\"hljs-keyword\">for</span> k <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.n):\n                    matrix.t[i][j] += self.t[i][k] * b.t[k][j]\n        <span class=\"hljs-keyword\">return</span> matrix\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">modular_exponentiation</span>(<span class=\"hljs-params\">a, b</span>):\n    matrix = Matrix([[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>]])\n    <span class=\"hljs-keyword\">while</span> b &gt; <span class=\"hljs-number\">0</span>:\n        <span class=\"hljs-keyword\">if</span> b &amp; <span class=\"hljs-number\">1</span>:\n            matrix *= a\n        a *= a\n        b &gt;&gt;= <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">return</span> matrix\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fibonacci_with_matrix_exponentiation</span>(<span class=\"hljs-params\">n, f1, f2</span>):\n    <span class=\"hljs-comment\"># Trivial Cases</span>\n    <span class=\"hljs-keyword\">if</span> n == <span class=\"hljs-number\">1</span>:\n        <span class=\"hljs-keyword\">return</span> f1\n    <span class=\"hljs-keyword\">elif</span> n == <span class=\"hljs-number\">2</span>:\n        <span class=\"hljs-keyword\">return</span> f2\n    matrix = Matrix([[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>]])\n    matrix = modular_exponentiation(matrix, n - <span class=\"hljs-number\">2</span>)\n    <span class=\"hljs-keyword\">return</span> f2 * matrix.t[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>] + f1 * matrix.t[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">1</span>]\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">simple_fibonacci</span>(<span class=\"hljs-params\">n, f1, f2</span>):\n    <span class=\"hljs-comment\"># Trivial Cases</span>\n    <span class=\"hljs-keyword\">if</span> n == <span class=\"hljs-number\">1</span>:\n        <span class=\"hljs-keyword\">return</span> f1\n    <span class=\"hljs-keyword\">elif</span> n == <span class=\"hljs-number\">2</span>:\n        <span class=\"hljs-keyword\">return</span> f2\n\n    fn_1 = f1\n    fn_2 = f2\n    n -= <span class=\"hljs-number\">2</span>\n\n    <span class=\"hljs-keyword\">while</span> n &gt; <span class=\"hljs-number\">0</span>:\n        fn_1, fn_2 = fn_1 + fn_2, fn_1\n        n -= <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-keyword\">return</span> fn_1\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">matrix_exponentiation_time</span>():\n    setup = <span class=\"hljs-string\">&quot;&quot;&quot;\nfrom random import randint\nfrom __main__ import fibonacci_with_matrix_exponentiation\n&quot;&quot;&quot;</span>\n    code = <span class=\"hljs-string\">&quot;fibonacci_with_matrix_exponentiation(randint(1,70000), 1, 1)&quot;</span>\n    exec_time = timeit.timeit(setup=setup, stmt=code, number=<span class=\"hljs-number\">100</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;With matrix exponentiation the average execution time is &quot;</span>, exec_time / <span class=\"hljs-number\">100</span>)\n    <span class=\"hljs-keyword\">return</span> exec_time\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">simple_fibonacci_time</span>():\n    setup = <span class=\"hljs-string\">&quot;&quot;&quot;\nfrom random import randint\nfrom __main__ import simple_fibonacci\n&quot;&quot;&quot;</span>\n    code = <span class=\"hljs-string\">&quot;simple_fibonacci(randint(1,70000), 1, 1)&quot;</span>\n    exec_time = timeit.timeit(setup=setup, stmt=code, number=<span class=\"hljs-number\">100</span>)\n    <span class=\"hljs-built_in\">print</span>(\n        <span class=\"hljs-string\">&quot;Without matrix exponentiation the average execution time is &quot;</span>, exec_time / <span class=\"hljs-number\">100</span>\n    )\n    <span class=\"hljs-keyword\">return</span> exec_time\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>():\n    matrix_exponentiation_time()\n    simple_fibonacci_time()\n\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    main()\n"
    },
    "c-plus-plus": {
      "dir": "others/matrix_exponentiation.cpp",
      "url": "https://github.com/TheAlgorithms/c-plus-plus/tree/master/others/matrix_exponentiation.cpp",
      "code": "<span class=\"hljs-comment\">/**\n@file\n@brief Matrix Exponentiation.\n\nThe problem can be solved with DP but constraints are high.\n&lt;br/&gt;\\f$a_i = b_i\\f$ (for \\f$i &lt;= k\\f$)\n&lt;br/&gt;\\f$a_i = c_1 a_{i-1} + c_2 a_{i-2} + ... + c_k a_{i-k}\\f$ (for \\f$i &gt; k\\f$)\n&lt;br/&gt;Taking the example of Fibonacci series, \\f$k=2\\f$\n&lt;br/&gt;\\f$b_1 = 1,\\; b_2=1\\f$\n&lt;br/&gt;\\f$c_1 = 1,\\; c_2=1\\f$\n&lt;br/&gt;\\f$a = \\begin{bmatrix}0&amp; 1&amp; 1&amp; 2&amp; \\ldots\\end{bmatrix}\\f$\n&lt;br/&gt;This way you can find the \\f$10^{18}\\f$ fibonacci number%MOD.\nI have given a general way to use it. The program takes the input of B and C\nmatrix.\n\nSteps for Matrix Expo\n1. Create vector F1 : which is the copy of B.\n2. Create transpose matrix (Learn more about it on the internet)\n3. Perform \\f$T^{n-1}\\f$ [transpose matrix to the power n-1]\n4. Multiply with F to get the last matrix of size (1\\f$\\times\\f$k).\n\nThe first element of this matrix is the required result.\n*/</span>\n\n<span class=\"hljs-meta\">#<span class=\"hljs-keyword\">include</span> <span class=\"hljs-string\">&lt;iostream&gt;</span></span>\n<span class=\"hljs-meta\">#<span class=\"hljs-keyword\">include</span> <span class=\"hljs-string\">&lt;vector&gt;</span></span>\n\n<span class=\"hljs-keyword\">using</span> std::cin;\n<span class=\"hljs-keyword\">using</span> std::cout;\n<span class=\"hljs-keyword\">using</span> std::vector;\n\n<span class=\"hljs-comment\">/*! shorthand definition for `int64_t` */</span>\n<span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> ll int64_t</span>\n\n<span class=\"hljs-comment\">/*! shorthand definition for `std::endl` */</span>\n<span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> endl std::endl</span>\n\n<span class=\"hljs-comment\">/*! shorthand definition for `int64_t` */</span>\n<span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> pb push_back</span>\n<span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> MOD 1000000007</span>\n\n<span class=\"hljs-comment\">/** global variable mat_size\n * @todo @stepfencurryxiao add documetnation\n */</span>\nll mat_size;\n\n<span class=\"hljs-comment\">/** global vector variables used in the ::ans function.\n * @todo @stepfencurryxiao add documetnation\n */</span>\nvector&lt;ll&gt; fib_b, fib_c;\n\n<span class=\"hljs-comment\">/** To multiply 2 matrices\n * \\param [in] A matrix 1 of size (m\\f$\\times\\f$n)\n * \\param [in] B \\p matrix 2 of size (p\\f$\\times\\f$q)\\n\\note \\f$p=n\\f$\n * \\result matrix of dimension (m\\f$\\times\\f$q)\n */</span>\nvector&lt;vector&lt;ll&gt;&gt; <span class=\"hljs-built_in\">multiply</span>(<span class=\"hljs-keyword\">const</span> vector&lt;vector&lt;ll&gt;&gt; &amp;A,\n                            <span class=\"hljs-keyword\">const</span> vector&lt;vector&lt;ll&gt;&gt; &amp;B) {\n    vector&lt;vector&lt;ll&gt;&gt; <span class=\"hljs-built_in\">C</span>(mat_size + <span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">vector</span>&lt;ll&gt;(mat_size + <span class=\"hljs-number\">1</span>));\n    <span class=\"hljs-keyword\">for</span> (ll i = <span class=\"hljs-number\">1</span>; i &lt;= mat_size; i++) {\n        <span class=\"hljs-keyword\">for</span> (ll j = <span class=\"hljs-number\">1</span>; j &lt;= mat_size; j++) {\n            <span class=\"hljs-keyword\">for</span> (ll z = <span class=\"hljs-number\">1</span>; z &lt;= mat_size; z++) {\n                C[i][j] = (C[i][j] + (A[i][z] * B[z][j]) % MOD) % MOD;\n            }\n        }\n    }\n    <span class=\"hljs-keyword\">return</span> C;\n}\n\n<span class=\"hljs-comment\">/** computing integer power of a matrix using recursive multiplication.\n * @note A must be a square matrix for this algorithm.\n * \\param [in] A base matrix\n * \\param [in] p exponent\n * \\return matrix of same dimension as A\n */</span>\nvector&lt;vector&lt;ll&gt;&gt; <span class=\"hljs-built_in\">power</span>(<span class=\"hljs-keyword\">const</span> vector&lt;vector&lt;ll&gt;&gt; &amp;A, ll p) {\n    <span class=\"hljs-keyword\">if</span> (p == <span class=\"hljs-number\">1</span>)\n        <span class=\"hljs-keyword\">return</span> A;\n    <span class=\"hljs-keyword\">if</span> (p % <span class=\"hljs-number\">2</span> == <span class=\"hljs-number\">1</span>) {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">multiply</span>(A, <span class=\"hljs-built_in\">power</span>(A, p - <span class=\"hljs-number\">1</span>));\n    } <span class=\"hljs-keyword\">else</span> {\n        vector&lt;vector&lt;ll&gt;&gt; X = <span class=\"hljs-built_in\">power</span>(A, p / <span class=\"hljs-number\">2</span>);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">multiply</span>(X, X);\n    }\n}\n\n<span class=\"hljs-comment\">/*! Wrapper for Fibonacci\n * \\param[in] n \\f$n^\\text{th}\\f$ Fibonacci number\n * \\return \\f$n^\\text{th}\\f$ Fibonacci number\n */</span>\n<span class=\"hljs-function\">ll <span class=\"hljs-title\">ans</span><span class=\"hljs-params\">(ll n)</span> </span>{\n    <span class=\"hljs-keyword\">if</span> (n == <span class=\"hljs-number\">0</span>)\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">if</span> (n &lt;= mat_size)\n        <span class=\"hljs-keyword\">return</span> fib_b[n - <span class=\"hljs-number\">1</span>];\n    <span class=\"hljs-comment\">// F1</span>\n    <span class=\"hljs-function\">vector&lt;ll&gt; <span class=\"hljs-title\">F1</span><span class=\"hljs-params\">(mat_size + <span class=\"hljs-number\">1</span>)</span></span>;\n    <span class=\"hljs-keyword\">for</span> (ll i = <span class=\"hljs-number\">1</span>; i &lt;= mat_size; i++) F1[i] = fib_b[i - <span class=\"hljs-number\">1</span>];\n\n    <span class=\"hljs-comment\">// Transpose matrix</span>\n    vector&lt;vector&lt;ll&gt;&gt; <span class=\"hljs-built_in\">T</span>(mat_size + <span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">vector</span>&lt;ll&gt;(mat_size + <span class=\"hljs-number\">1</span>));\n    <span class=\"hljs-keyword\">for</span> (ll i = <span class=\"hljs-number\">1</span>; i &lt;= mat_size; i++) {\n        <span class=\"hljs-keyword\">for</span> (ll j = <span class=\"hljs-number\">1</span>; j &lt;= mat_size; j++) {\n            <span class=\"hljs-keyword\">if</span> (i &lt; mat_size) {\n                <span class=\"hljs-keyword\">if</span> (j == i + <span class=\"hljs-number\">1</span>)\n                    T[i][j] = <span class=\"hljs-number\">1</span>;\n                <span class=\"hljs-keyword\">else</span>\n                    T[i][j] = <span class=\"hljs-number\">0</span>;\n                <span class=\"hljs-keyword\">continue</span>;\n            }\n            T[i][j] = fib_c[mat_size - j];\n        }\n    }\n    <span class=\"hljs-comment\">// T^n-1</span>\n    T = <span class=\"hljs-built_in\">power</span>(T, n - <span class=\"hljs-number\">1</span>);\n\n    <span class=\"hljs-comment\">// T*F1</span>\n    ll res = <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">for</span> (ll i = <span class=\"hljs-number\">1</span>; i &lt;= mat_size; i++) {\n        res = (res + (T[<span class=\"hljs-number\">1</span>][i] * F1[i]) % MOD) % MOD;\n    }\n    <span class=\"hljs-keyword\">return</span> res;\n}\n\n<span class=\"hljs-comment\">/** Main function */</span>\n<span class=\"hljs-function\"><span class=\"hljs-type\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>{\n    cin.<span class=\"hljs-built_in\">tie</span>(<span class=\"hljs-number\">0</span>);\n    cout.<span class=\"hljs-built_in\">tie</span>(<span class=\"hljs-number\">0</span>);\n    ll t;\n    cin &gt;&gt; t;\n    ll i, j, x;\n    <span class=\"hljs-keyword\">while</span> (t--) {\n        cin &gt;&gt; mat_size;\n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; mat_size; i++) {\n            cin &gt;&gt; x;\n            fib_b.<span class=\"hljs-built_in\">pb</span>(x);\n        }\n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; mat_size; i++) {\n            cin &gt;&gt; x;\n            fib_c.<span class=\"hljs-built_in\">pb</span>(x);\n        }\n        cin &gt;&gt; x;\n        cout &lt;&lt; <span class=\"hljs-built_in\">ans</span>(x) &lt;&lt; endl;\n        fib_b.<span class=\"hljs-built_in\">clear</span>();\n        fib_c.<span class=\"hljs-built_in\">clear</span>();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}\n"
    }
  },
  "contributors": [
    {
      "name": "stepfencurryxiao",
      "email": "stepfencurryxiao@gmail.com",
      "commits": 1
    },
    {
      "name": "Kushagra Nigam",
      "email": "kushagra1998@gmail.com",
      "commits": 1
    },
    {
      "name": "Aniruddha Bhattacharjee",
      "email": "aniruddha97bhatt@gmail.com",
      "commits": 1
    },
    {
      "name": "William Zhang",
      "email": "39932068+WilliamHYZhang@users.noreply.github.com",
      "commits": 1
    },
    {
      "name": "Krishna Vedala",
      "email": "7001608+kvedala@users.noreply.github.com",
      "commits": 2
    },
    {
      "name": "Christian Clauss",
      "email": "cclauss@me.com",
      "commits": 5
    }
  ],
  "explanationUrl": {}
}
